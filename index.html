<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Podcast Planner Tool</title>
    <style>
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --bg-color: #ffffff;
            --text-color: #333333;
            --section-bg: #f8f9fa;
            --border-color: #dee2e6;
            --input-bg: #ffffff;
            --card-bg: #ffffff;
        }

        body.dark-mode {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --section-bg: #2d2d2d;
            --border-color: #404040;
            --input-bg: #2d2d2d;
            --card-bg: #252525;
            --primary-color-dark: var(--primary-color);
            --secondary-color-dark: var(--secondary-color);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            min-height: 100vh;
            padding: 20px;
            color: var(--text-color);
            transition: all 0.3s ease;
        }

        .mobile-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .mobile-warning.active {
            display: flex;
        }

        .mobile-warning-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .mobile-warning-content h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .mobile-warning-content p {
            color: #495057;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .mobile-warning-content .icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--bg-color);
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .tabs {
            display: flex;
            background: var(--section-bg);
            border-bottom: 2px solid var(--border-color);
        }

        .tab {
            flex: 1;
            padding: 20px;
            text-align: center;
            background: var(--section-bg);
            border: none;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
            transition: all 0.3s ease;
            border-bottom: 3px solid transparent;
        }

        .tab.settings-tab {
            flex: 0 0 80px;
            font-size: 20px;
        }

        .tab:hover {
            background: var(--border-color);
        }

        .tab.active {
            background: var(--bg-color);
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
        }

        .tab-content {
            display: none;
            padding: 30px;
            animation: fadeIn 0.3s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section {
            margin-bottom: 40px;
            padding: 25px;
            background: var(--section-bg);
            border-radius: 10px;
        }

        .section h2 {
            color: var(--primary-color);
            margin-bottom: 20px;
            font-size: 1.5em;
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 10px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-color);
        }

        .form-group input[type="text"],
        .form-group input[type="number"],
        .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            background: var(--input-bg);
            color: var(--text-color);
        }

        .form-group input:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .checkbox-group {
            display: flex;
            gap: 20px;
            margin-top: 10px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }

        .btn-danger {
            background: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 12px;
        }

        .key-points-container {
            margin-top: 10px;
        }

        .key-point-item {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            align-items: center;
        }

        .key-point-item input {
            flex: 1;
        }

        .people-list {
            margin-top: 20px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }

        .segment-list {
            margin-top: 20px;
        }

        .person-item {
            background: white;
            padding: 20px;
            border-radius: 12px;
            border: 3px solid #dee2e6;
            display: flex;
            flex-direction: column;
            gap: 12px;
            position: relative;
            transition: all 0.3s ease;
        }

        .person-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        .segment-item {
            background: white;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 8px;
            border: 2px solid #dee2e6;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .person-info {
            flex: 1;
            text-align: center;
        }

        .person-info strong {
            color: #495057;
            font-size: 18px;
            display: block;
            margin-bottom: 8px;
        }

        .person-color-bar {
            height: 6px;
            border-radius: 3px;
            margin-bottom: 12px;
        }

        .person-item .btn {
            width: 100%;
        }

        .person-badges {
            display: flex;
            gap: 8px;
            margin-top: 5px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }

        .badge-host {
            background: #667eea;
            color: white;
        }

        .badge-guest {
            background: #28a745;
            color: white;
        }

        .badge-producer {
            background: #ffc107;
            color: #333;
        }

        .badge-custom {
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .color-picker-group {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .color-picker-group input[type="color"] {
            width: 60px;
            height: 40px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
        }

        .segment-item {
            flex-direction: column;
            align-items: stretch;
            position: relative;
            cursor: move;
            transition: all 0.2s ease;
        }

        .segment-item.dragging {
            opacity: 0.5;
            transform: scale(0.95);
        }

        .segment-item.drag-over {
            border-color: #667eea;
            border-width: 3px;
            background: #f0f3ff;
        }

        .segment-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .segment-title {
            font-size: 18px;
            font-weight: 700;
            color: #495057;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .drag-handle {
            cursor: grab;
            color: #6c757d;
            font-size: 20px;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        .segment-time {
            background: #667eea;
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
        }

        .segment-description {
            color: #6c757d;
            margin-bottom: 15px;
            line-height: 1.6;
        }

        .segment-key-points {
            margin-bottom: 15px;
        }

        .segment-key-points ul {
            margin-left: 20px;
            color: #495057;
        }

        .segment-key-points li {
            margin-bottom: 5px;
        }

        .segment-people {
            margin-bottom: 15px;
        }

        .segment-people-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 8px;
        }

        .segment-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .segment-item.collapsed .segment-description,
        .segment-item.collapsed .segment-key-points,
        .segment-item.collapsed .segment-people {
            display: none;
        }

        .segment-item.collapsed .segment-actions > div {
            display: none !important;
        }

        .segment-item.collapsed .segment-actions {
            display: flex !important;
        }

        .calculator-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 15px;
        }

        .calculator-item {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 2px solid #dee2e6;
        }

        .calculator-label {
            font-size: 14px;
            color: #6c757d;
            margin-bottom: 8px;
            text-align: center;
        }

        .calculator-value {
            font-size: 32px;
            font-weight: 700;
            color: #667eea;
            text-align: center;
        }

        .empty-state {
            text-align: center;
            padding: 40px;
            color: #6c757d;
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        select {
            width: 100%;
            padding: 12px;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            background: white;
            cursor: pointer;
        }

        select:focus {
            outline: none;
            border-color: #667eea;
        }

        .char-counter {
            font-size: 12px;
            color: #6c757d;
            text-align: right;
            margin-top: 5px;
        }

        .prompt-box {
            background: white;
            border: 2px solid #dee2e6;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
        }

        .prompt-title {
            font-size: 18px;
            font-weight: 700;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #f0f3ff;
        }

        .prompt-instructions {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 12px 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            color: #856404;
            font-size: 14px;
        }

        .prompt-instructions strong {
            display: block;
            margin-bottom: 5px;
            color: #856404;
        }

        .prompt-text {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 1px solid #dee2e6;
            font-size: 15px;
            line-height: 1.6;
            color: #495057;
            margin-bottom: 15px;
            min-height: 80px;
        }

        .prompt-actions {
            display: flex;
            justify-content: flex-end;
        }

        .copy-feedback {
            display: inline-block;
            color: #28a745;
            font-size: 14px;
            margin-right: 10px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .copy-feedback.show {
            opacity: 1;
        }

        .version {
            position: fixed;
            bottom: 15px;
            left: 15px;
            color: #adb5bd;
            font-size: 12px;
            font-family: 'Courier New', monospace;
            z-index: 1000;
        }

        .upload-zone {
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 60px 40px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-zone:hover {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .upload-zone.drag-over {
            border-color: #667eea;
            background: #e6ebff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 18px;
            color: #495057;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 14px;
            color: #6c757d;
        }

        .file-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #28a745;
            margin-top: 20px;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .file-name {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }

        .file-size {
            color: #6c757d;
            font-size: 14px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #f5c6cb;
            margin-top: 15px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .upload-zone {
            border: 3px dashed #dee2e6;
            border-radius: 12px;
            padding: 60px 40px;
            text-align: center;
            background: #f8f9fa;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .upload-zone:hover {
            border-color: #667eea;
            background: #f0f3ff;
        }

        .upload-zone.drag-over {
            border-color: #667eea;
            background: #e6ebff;
            transform: scale(1.02);
        }

        .upload-icon {
            font-size: 48px;
            margin-bottom: 16px;
        }

        .upload-text {
            font-size: 18px;
            color: #495057;
            font-weight: 600;
            margin-bottom: 8px;
        }

        .upload-hint {
            font-size: 14px;
            color: #6c757d;
        }

        .file-info {
            background: white;
            padding: 20px;
            border-radius: 8px;
            border: 2px solid #28a745;
            margin-top: 20px;
            display: none;
        }

        .file-info.show {
            display: block;
        }

        .file-name {
            font-weight: 600;
            color: #495057;
            margin-bottom: 8px;
        }

        .file-size {
            color: #6c757d;
            font-size: 14px;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            border: 1px solid #f5c6cb;
            margin-top: 15px;
            display: none;
        }

        .error-message.show {
            display: block;
        }

        .mobile-warning {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            z-index: 9999;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .mobile-warning.active {
            display: flex;
        }

        .mobile-warning-content {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            max-width: 400px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
        }

        .mobile-warning-content h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .mobile-warning-content p {
            color: #495057;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .mobile-warning-content .icon {
            font-size: 4em;
            margin-bottom: 20px;
        }

        .settings-option {
            margin-bottom: 25px;
            padding: 20px;
            background: var(--card-bg);
            border-radius: 8px;
            border: 1px solid var(--border-color);
        }

        .settings-option h3 {
            color: var(--primary-color);
            margin-bottom: 15px;
            font-size: 1.1em;
        }

        .theme-buttons, .color-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .theme-btn, .color-btn {
            padding: 10px 20px;
            border: 2px solid var(--border-color);
            background: var(--input-bg);
            color: var(--text-color);
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .theme-btn:hover, .color-btn:hover {
            border-color: var(--primary-color);
            transform: translateY(-2px);
        }

        .theme-btn.active, .color-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .color-btn {
            min-width: 140px;
            position: relative;
        }

        .color-preview {
            width: 100%;
            height: 4px;
            border-radius: 2px;
            margin-top: 5px;
        }

        /* Section collapse functionality */
        .section-header {
            display: flex;
            align-items: center;
            cursor: pointer;
            user-select: none;
            margin-bottom: 20px;
        }

        .section-toggle {
            font-size: 20px;
            margin-right: 10px;
            color: var(--primary-color);
            font-weight: bold;
            min-width: 24px;
            text-align: center;
        }

        .section-content {
            display: block;
        }

        .section-content.collapsed {
            display: none;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 767px) {
            /* Container adjustments */
            .container {
                padding: 10px;
                max-width: 100%;
            }

            .header {
                padding: 15px;
            }

            .header h1 {
                font-size: 24px;
            }

            .header p {
                font-size: 14px;
            }

            /* Tabs - make them scrollable horizontally if needed */
            .tabs {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
            }

            .tab {
                padding: 12px 16px;
                font-size: 14px;
                white-space: nowrap;
            }

            /* Forms - make all inputs full width */
            .form-row {
                flex-direction: column;
            }

            .form-group {
                margin-bottom: 15px;
            }

            input[type="text"],
            input[type="number"],
            input[type="date"],
            textarea,
            select {
                font-size: 16px; /* Prevents zoom on iOS */
            }

            /* Buttons - make them larger for touch */
            .btn {
                padding: 14px 20px;
                font-size: 16px;
                min-height: 44px; /* iOS recommended touch target */
            }

            .btn-small {
                padding: 10px 16px;
                min-height: 40px;
            }

            /* People and Assets Grid */
            .people-grid {
                grid-template-columns: 1fr;
                gap: 10px;
            }

            .person-item {
                padding: 12px;
            }

            /* Calculator - stack vertically */
            .calculator {
                grid-template-columns: 1fr;
                gap: 15px;
            }

            /* Timings section - stack vertically */
            .section div[style*="grid-template-columns: 1fr 1fr 1fr"] {
                display: flex !important;
                flex-direction: column !important;
            }

            /* Segments - simplify layout */
            .segment-item {
                padding: 15px;
            }

            .segment-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .segment-actions {
                width: 100%;
                display: flex;
                flex-direction: column;
                gap: 10px;
            }

            .segment-actions select,
            .segment-actions button {
                width: 100%;
            }

            /* Key points list */
            .key-point-item {
                padding: 8px 10px;
                font-size: 14px;
            }

            /* Pills */
            .person-pill,
            .asset-pill {
                font-size: 12px;
                padding: 4px 10px;
            }

            /* Export buttons - stack vertically */
            .export-buttons {
                flex-direction: column;
            }

            .export-buttons .btn {
                width: 100%;
            }

            /* Calculator items */
            .calculator-item {
                padding: 15px;
            }

            .calculator-value {
                font-size: 28px;
            }

            /* Timer display */
            #timerDisplay {
                font-size: 48px;
            }

            /* Timer buttons - make 2x2 grid on very small screens */
            .section div[style*="display: flex"][style*="gap: 10px"] button {
                flex: 1 1 45%;
                min-width: 120px;
            }

            /* Settings */
            .theme-buttons,
            .color-options {
                flex-direction: column;
            }

            .theme-btn,
            .color-btn {
                width: 100%;
            }

            /* Reduce spacing */
            .section {
                padding: 15px;
                margin-bottom: 15px;
            }

            /* AI Prompts */
            .ai-prompt-item {
                padding: 15px;
            }

            /* Segment list in Planner Details */
            .segment-list-item {
                padding: 12px;
            }

            /* Make drag handle less prominent on mobile */
            .drag-handle {
                font-size: 18px;
                padding: 10px 8px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
</head>
<body>
    <!-- Mobile Warning Overlay -->
    <div class="mobile-warning" id="mobileWarning">
        <div class="mobile-warning-content">
            <div class="icon">üì±</div>
            <h2>Mobile Device Detected</h2>
            <p><strong>This tool is not ideal on phone screens.</strong></p>
            <p>For the best experience, please use a desktop browser or tablet with a larger screen.</p>
            <button class="btn btn-primary" onclick="dismissMobileWarning()" style="margin-top: 20px;">Continue Anyway</button>
        </div>
    </div>

    <div class="container">
        <div class="header">
            <h1>üéôÔ∏è Podcast Planner Tool</h1>
            <p>Plan, organize, and structure your podcast episodes</p>
        </div>

        <div class="tabs">
            <button class="tab" onclick="switchTab(0)">+ Planner Details</button>
            <button class="tab active" onclick="switchTab(1)">Planner</button>
            <button class="tab" onclick="switchTab(2)">Go Live</button>
            <button class="tab" onclick="switchTab(3)">Further Help</button>
            <button class="tab settings-tab" onclick="switchTab(4)">‚öôÔ∏è</button>
        </div>

        <!-- Tab 1: Planner Details -->
        <div class="tab-content">
            <!-- Podcast Episode Details -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('episode-details-content')">
                    <span class="section-toggle" id="episode-details-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Podcast Episode Details</h2>
                </div>
                <div class="section-content" id="episode-details-content">
                <div class="form-group">
                    <label for="episodeTitle">Episode Title</label>
                    <input type="text" id="episodeTitle" placeholder="Enter episode title" oninput="saveEpisodeDetails()">
                </div>
                <div class="form-group">
                    <label for="episodeNumber">Episode Number</label>
                    <input type="text" id="episodeNumber" placeholder="Enter episode number" oninput="saveEpisodeDetails()">
                </div>
                <div class="form-group">
                    <label for="episodeSeason">Episode Season</label>
                    <input type="text" id="episodeSeason" placeholder="Enter episode season" oninput="saveEpisodeDetails()">
                </div>
                <div class="form-group">
                    <label for="recordingDate">Recording Date</label>
                    <input type="date" id="recordingDate" oninput="saveEpisodeDetails()">
                </div>
                <div class="form-group">
                    <label for="airDate">Air Date</label>
                    <input type="date" id="airDate" oninput="saveEpisodeDetails()">
                </div>
                </div>
            </div>

            <!-- Add Hosts / Guests Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('add-people-content')">
                    <span class="section-toggle" id="add-people-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Add Hosts / Guests</h2>
                </div>
                <div class="section-content" id="add-people-content">
                <div class="form-group">
                    <label for="personName">Name</label>
                    <input type="text" id="personName" placeholder="Enter name">
                </div>
                <div class="form-group">
                    <label>Role(s)</label>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" id="roleHost" value="host">
                            Host
                        </label>
                        <label>
                            <input type="checkbox" id="roleGuest" value="guest">
                            Guest
                        </label>
                        <label>
                            <input type="checkbox" id="roleProducer" value="producer">
                            Producer
                        </label>
                    </div>
                </div>
                <div class="form-group">
                    <label for="personColor">Color</label>
                    <div class="color-picker-group">
                        <input type="color" id="personColor" value="#667eea">
                        <span>Choose a color to represent this person</span>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addPerson()">Add Person</button>
                
                <div class="people-list" id="peopleList"></div>
                </div>
            </div>

            <!-- Add Assets Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('add-assets-content')">
                    <span class="section-toggle" id="add-assets-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Add Assets</h2>
                </div>
                <div class="section-content" id="add-assets-content">
                <div class="form-group">
                    <label for="assetName">Asset</label>
                    <input type="text" id="assetName" placeholder="Enter asset name (e.g., microphone, camera, etc.)">
                </div>
                <div class="form-group">
                    <label for="assetColor">Color</label>
                    <div class="color-picker-group">
                        <input type="color" id="assetColor" value="#43e97b">
                        <span>Choose a color for this asset</span>
                    </div>
                </div>
                <button class="btn btn-primary" onclick="addAsset()">Add Asset</button>
                
                <div class="people-list" id="assetsList"></div>
                </div>
            </div>

            <!-- Add Content Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('add-content-content')">
                    <span class="section-toggle" id="add-content-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Add Content</h2>
                </div>
                <div class="section-content" id="add-content-content">
                <div class="form-group">
                    <label for="segmentTitle">Segment Title</label>
                    <input type="text" id="segmentTitle" placeholder="Enter segment title">
                </div>
                <div class="form-group">
                    <label for="segmentDescription">Brief Description</label>
                    <textarea id="segmentDescription" placeholder="Enter brief description (max 500 characters)" maxlength="500" oninput="updateCharCounter()"></textarea>
                    <div class="char-counter" id="charCounter">0 / 500</div>
                </div>
                <div class="form-group">
                    <label>Key Points</label>
                    <div class="key-points-container" id="keyPointsContainer">
                        <div class="key-point-item">
                            <input type="text" class="key-point-input" placeholder="Enter key point">
                            <button class="btn btn-primary btn-small" onclick="addKeyPoint()">Add</button>
                        </div>
                    </div>
                </div>
                <div class="form-group">
                    <label for="estimatedTime">Estimated Time (Minutes)</label>
                    <input type="number" id="estimatedTime" placeholder="Enter estimated time in minutes" min="1">
                </div>
                <button class="btn btn-primary" onclick="addSegment()">Add Segment</button>
                
                <div class="segment-list" id="addedSegmentsList" style="margin-top: 20px;"></div>
                </div>
            </div>

            <!-- Clear Data Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('clear-data-content')">
                    <span class="section-toggle" id="clear-data-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Clear Data</h2>
                </div>
                <div class="section-content" id="clear-data-content">
                <button class="btn btn-danger" onclick="clearEpisodeDetails()">Clear Episode Details</button>
                <button class="btn btn-danger" onclick="clearPeople()">Clear Hosts / Guests</button>
                <button class="btn btn-danger" onclick="clearAssets()">Clear Assets</button>
                <button class="btn btn-danger" onclick="clearSegments()">Clear Segments</button>
                </div>
            </div>
        </div>

        <!-- Tab 2: Planner -->
        <div class="tab-content active">
            <!-- Podcast Episode Details Display -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('planner-episode-details-content')">
                    <span class="section-toggle" id="planner-episode-details-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Podcast Episode Details</h2>
                </div>
                <div class="section-content" id="planner-episode-details-content">
                <div class="info-box" style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea;">
                    <div class="info-item" style="margin: 12px 0;">
                        <span style="font-weight: 600; color: #495057; display: inline-block; min-width: 140px;">Episode Title:</span>
                        <span id="displayEpisodeTitle" style="color: #6c757d;">Not set</span>
                    </div>
                    <div class="info-item" style="margin: 12px 0;">
                        <span style="font-weight: 600; color: #495057; display: inline-block; min-width: 140px;">Episode Number:</span>
                        <span id="displayEpisodeNumber" style="color: #6c757d;">Not set</span>
                    </div>
                    <div class="info-item" style="margin: 12px 0;">
                        <span style="font-weight: 600; color: #495057; display: inline-block; min-width: 140px;">Episode Season:</span>
                        <span id="displayEpisodeSeason" style="color: #6c757d;">Not set</span>
                    </div>
                    <div class="info-item" style="margin: 12px 0;">
                        <span style="font-weight: 600; color: #495057; display: inline-block; min-width: 140px;">Recording Date:</span>
                        <span id="displayRecordingDate" style="color: #6c757d;">Not set</span>
                    </div>
                    <div class="info-item" style="margin: 12px 0;">
                        <span style="font-weight: 600; color: #495057; display: inline-block; min-width: 140px;">Air Date:</span>
                        <span id="displayAirDate" style="color: #6c757d;">Not set</span>
                    </div>
                </div>
                </div>
            </div>

            <!-- People Involved Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('planner-people-content')">
                    <span class="section-toggle" id="planner-people-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">People Involved</h2>
                </div>
                <div class="section-content" id="planner-people-content">
                <div class="people-list" id="plannerPeopleList"></div>
                </div>
            </div>

            <!-- Assets Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('planner-assets-content')">
                    <span class="section-toggle" id="planner-assets-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Required Assets</h2>
                </div>
                <div class="section-content" id="planner-assets-content">
                <div class="people-list" id="plannerAssetsList"></div>
                </div>
            </div>

            <!-- Episode Calculator -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('planner-calculator-content')">
                    <span class="section-toggle" id="planner-calculator-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Episode Calculator</h2>
                </div>
                <div class="section-content" id="planner-calculator-content">
                <div class="calculator-grid">
                    <div class="calculator-item">
                        <div class="calculator-label">Number of Segments</div>
                        <div class="calculator-value" id="segmentCount">0</div>
                    </div>
                    <div class="calculator-item">
                        <div class="calculator-label">Total Runtime (Minutes)</div>
                        <div class="calculator-value" id="totalRuntime">0</div>
                    </div>
                </div>
                </div>
            </div>

            <!-- Segments List -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('planner-segments-content')" style="justify-content: space-between;">
                    <div style="display: flex; align-items: center;">
                        <span class="section-toggle" id="planner-segments-content-toggle">‚àí</span>
                        <h2 style="margin: 0;">Episode Segments</h2>
                    </div>
                    <button class="btn btn-primary" id="toggleCollapseBtn" onclick="event.stopPropagation(); toggleCollapseAll()" style="margin: 0;">Collapse All</button>
                </div>
                <div class="section-content" id="planner-segments-content">
                <div class="segment-list" id="segmentList"></div>
                </div>
            </div>

            <!-- Export Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('planner-export-content')">
                    <span class="section-toggle" id="planner-export-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Export</h2>
                </div>
                <div class="section-content" id="planner-export-content">
                <div style="display: flex; flex-direction: column; gap: 10px; max-width: 300px;">
                    <button class="btn btn-primary" onclick="exportAsPlainText()" style="margin: 0; width: 100%;">üìÑ Export as Plain Text</button>
                    <button class="btn btn-primary" onclick="exportAsPDF()" style="margin: 0; width: 100%;">üìë Export as PDF</button>
                    <button class="btn btn-primary" onclick="exportAsJPG()" style="margin: 0; width: 100%;">üñºÔ∏è Export to JPG</button>
                    <button class="btn btn-primary" onclick="exportAsJSON()" style="margin: 0; width: 100%;">üíæ Export Show as JSON</button>
                    <button class="btn btn-primary" onclick="importFromJSON()" style="margin: 0; width: 100%;">üìÇ Import Show as JSON</button>
                </div>
                <input type="file" id="jsonFileInput" accept=".json" style="display: none;" onchange="handleJSONImport(event)">
                </div>
            </div>
        </div>

        <!-- Tab 3: Go Live -->
        <div class="tab-content">
            <!-- Timings Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('golive-timings-content')">
                    <span class="section-toggle" id="golive-timings-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Timings</h2>
                </div>
                <div class="section-content" id="golive-timings-content">
                <div style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                    <div class="calculator-item" style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
                        <div class="calculator-label">Estimated Time</div>
                        <div class="calculator-value" id="goLiveEstimatedTime" style="font-size: 36px;">0 min</div>
                    </div>
                    <div style="display: flex; flex-direction: column; gap: 20px;">
                        <div class="calculator-item">
                            <div class="calculator-label">Total Time</div>
                            <div class="calculator-value" id="goLiveTotalTime">0:00:00</div>
                        </div>
                        <div style="display: grid; grid-template-columns: 1fr; gap: 20px;">
                            <div class="calculator-item" style="background: #d4edda; border: 2px solid #28a745;">
                                <div class="calculator-label">Segments Recorded</div>
                                <div class="calculator-value" id="goLiveRecorded">0</div>
                            </div>
                            <div class="calculator-item" style="background: #f8d7da; border: 2px solid #dc3545;">
                                <div class="calculator-label">Segments Left</div>
                                <div class="calculator-value" id="goLiveLeft">0</div>
                            </div>
                        </div>
                    </div>
                    <div class="calculator-item" style="display: flex; flex-direction: column; justify-content: center; align-items: center;">
                        <div class="calculator-label">Total Segments</div>
                        <div class="calculator-value" id="goLiveTotalSegments" style="font-size: 36px;">0</div>
                    </div>
                </div>
                </div>
            </div>

            <!-- Timer Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('golive-timer-content')">
                    <span class="section-toggle" id="golive-timer-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Timer</h2>
                </div>
                <div class="section-content" id="golive-timer-content">
                <div style="text-align: center; margin-bottom: 30px;">
                    <div id="timerDisplay" style="font-size: 72px; font-weight: bold; font-family: 'Courier New', monospace; color: #dc3545; margin-bottom: 20px;">00:00:00</div>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <button class="btn" id="startBtn" onclick="startTimer()" style="background: #28a745; color: white; margin: 0;">‚ñ∂ Start</button>
                        <button class="btn" id="pauseBtn" onclick="pauseTimer()" style="background: #007bff; color: white; margin: 0;">‚è∏ Pause</button>
                        <button class="btn" id="stopBtn" onclick="stopTimer()" style="background: #dc3545; color: white; margin: 0;">‚èπ Stop</button>
                        <button class="btn" id="resetBtn" onclick="resetTimer()" style="background: #6c757d; color: white; margin: 0;">‚Ü∫ Reset</button>
                    </div>
                </div>
                </div>
            </div>

            <!-- Segment Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('golive-segment-content')">
                    <span class="section-toggle" id="golive-segment-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Segment</h2>
                </div>
                <div class="section-content" id="golive-segment-content">
                <div id="currentSegmentDisplay" style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                    <p style="color: #6c757d; text-align: center;">No segments available. Add segments in the Planner Details tab.</p>
                </div>
                <div id="segmentControls" style="display: none; margin-top: 20px;">
                    <div class="form-group">
                        <label>Recording Notes</label>
                        <textarea id="recordingNotes" placeholder="Add notes about this segment..." style="min-height: 100px;"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Recorded Time</label>
                        <input type="text" id="recordedTime" readonly style="background: #e9ecef; cursor: not-allowed;">
                    </div>
                    <div style="display: flex; gap: 10px; margin-top: 20px;">
                        <button class="btn btn-primary" onclick="previousSegment()" id="prevSegmentBtn">‚Üê Previous</button>
                        <button class="btn btn-primary" onclick="nextSegment()" id="nextSegmentBtnPlain">Next ‚Üí</button>
                        <button class="btn btn-primary" onclick="saveAndNextSegment()" id="nextSegmentBtn">Save & Next ‚Üí</button>
                    </div>
                </div>
                </div>
            </div>

            <!-- Export Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('golive-export-content')">
                    <span class="section-toggle" id="golive-export-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Export</h2>
                </div>
                <div class="section-content" id="golive-export-content">
                <div style="display: flex; flex-direction: column; gap: 10px; max-width: 300px;">
                    <button class="btn btn-primary" onclick="exportAsPlainText()" style="margin: 0; width: 100%;">üìÑ Export as Plain Text</button>
                    <button class="btn btn-primary" onclick="exportAsPDF()" style="margin: 0; width: 100%;">üìë Export as PDF</button>
                    <button class="btn btn-primary" onclick="exportAsJPG()" style="margin: 0; width: 100%;">üñºÔ∏è Export to JPG</button>
                    <button class="btn btn-primary" onclick="exportAsJSON()" style="margin: 0; width: 100%;">üíæ Export Show as JSON</button>
                    <button class="btn btn-primary" onclick="importFromJSON()" style="margin: 0; width: 100%;">üìÇ Import Show as JSON</button>
                </div>
                <input type="file" id="jsonFileInput" accept=".json" style="display: none;" onchange="handleJSONImport(event)">
                </div>
            </div>
        </div>

        <!-- Tab 4: Further Help -->
        <div class="tab-content">
            <!-- User Guide Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('user-guide-content')">
                    <span class="section-toggle" id="user-guide-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">User Guide</h2>
                </div>
                <div class="section-content" id="user-guide-content">
                <p style="margin-bottom: 30px; line-height: 1.6;">
                    Need help getting started or using a specific feature? Check out our comprehensive 
                    <a href="https://github.com/TomJamesBW/PodcastPlanner/blob/main/UserGuide.md" target="_blank" style="color: var(--primary-color); text-decoration: underline;">User Guide</a> 
                    for step-by-step instructions and tips.
                </p>
                </div>
            </div>

            <!-- Useful Prompts Section -->
            <div class="section">
                <div class="section-header" onclick="toggleSection('prompts-content')">
                    <span class="section-toggle" id="prompts-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Useful Prompts</h2>
                </div>
                <div class="section-content" id="prompts-content">
                <p style="color: #6c757d; margin-bottom: 20px;">AI is best used with a transcript file in txt format. If you do not have a transcript yet, you can use the Export as plain text option on the planner page (ensure you put as much info as you can in to the segments).</p>
                
                <!-- Prompt 1 -->
                <div class="prompt-box">
                    <div class="prompt-title">Get Metadata</div>
                    <div class="prompt-instructions">
                        <strong>üìã Instructions:</strong>
                        Add your transcript to the Chat agent before using this prompt.
                    </div>
                    <div class="prompt-text" id="prompt1">
                        Please read my transcript, break it in to sections and then create me an SEO rich meta data for my show. You can use emojis but also ensure its clear to read.
                    </div>
                    <div class="prompt-actions">
                        <span class="copy-feedback" id="feedback1">‚úì Copied!</span>
                        <button class="btn btn-secondary btn-small" onclick="askCopilot()">Ask Copilot</button>
                        <button class="btn btn-secondary btn-small" onclick="askChatGPT()">Ask ChatGPT</button>
                        <button class="btn btn-secondary btn-small" onclick="askGemini()">Ask Gemini</button>
                        <button class="btn btn-primary btn-small" onclick="copyPrompt('prompt1', 'feedback1')">Copy Prompt</button>
                    </div>
                </div>

                <!-- Prompt 2 -->
                <div class="prompt-box">
                    <div class="prompt-title">Get Episode Titles</div>
                    <div class="prompt-instructions">
                        <strong>üìã Instructions:</strong>
                        Add your transcript to the Chat agent before using this prompt.
                    </div>
                    <div class="prompt-text" id="prompt2">
                        Using my transcript, give me 5 normal titles, 5 SEO rich titles, 5 funny / weird / interesting titles.
                    </div>
                    <div class="prompt-actions">
                        <span class="copy-feedback" id="feedback2">‚úì Copied!</span>
                        <button class="btn btn-secondary btn-small" onclick="askCopilot()">Ask Copilot</button>
                        <button class="btn btn-secondary btn-small" onclick="askChatGPT()">Ask ChatGPT</button>
                        <button class="btn btn-secondary btn-small" onclick="askGemini()">Ask Gemini</button>
                        <button class="btn btn-primary btn-small" onclick="copyPrompt('prompt2', 'feedback2')">Copy Prompt</button>
                    </div>
                </div>

                <!-- Prompt 3 -->
                <div class="prompt-box">
                    <div class="prompt-title">Get Keywords</div>
                    <div class="prompt-instructions">
                        <strong>üìã Instructions:</strong>
                        Add your transcript to the Chat agent before using this prompt.
                    </div>
                    <div class="prompt-text" id="prompt3">
                        Using my transcript, give me the following: a comma separated list of SEO keywords. The same list as hashtags.
                    </div>
                    <div class="prompt-actions">
                        <span class="copy-feedback" id="feedback3">‚úì Copied!</span>
                        <button class="btn btn-secondary btn-small" onclick="askCopilot()">Ask Copilot</button>
                        <button class="btn btn-secondary btn-small" onclick="askChatGPT()">Ask ChatGPT</button>
                        <button class="btn btn-secondary btn-small" onclick="askGemini()">Ask Gemini</button>
                        <button class="btn btn-primary btn-small" onclick="copyPrompt('prompt3', 'feedback3')">Copy Prompt</button>
                    </div>
                </div>

                <!-- Prompt 4 -->
                <div class="prompt-box">
                    <div class="prompt-title">Generate Social Media Content</div>
                    <div class="prompt-instructions">
                        <strong>üìã Instructions:</strong>
                        Add your transcript to the Chat agent before using this prompt.
                    </div>
                    <div class="prompt-text" id="prompt4">
                        Using my transcript, create me 8 days of social media posts that fit to the standard limit of 'x.com'. The first one should be for 'Out Tomorrow', the next should be 'Out Now' with the rest acting as reminders the episode is released.
                    </div>
                    <div class="prompt-actions">
                        <span class="copy-feedback" id="feedback4">‚úì Copied!</span>
                        <button class="btn btn-secondary btn-small" onclick="askCopilot()">Ask Copilot</button>
                        <button class="btn btn-secondary btn-small" onclick="askChatGPT()">Ask ChatGPT</button>
                        <button class="btn btn-secondary btn-small" onclick="askGemini()">Ask Gemini</button>
                        <button class="btn btn-primary btn-small" onclick="copyPrompt('prompt4', 'feedback4')">Copy Prompt</button>
                    </div>
                </div>

                <!-- Prompt 5 -->
                <div class="prompt-box">
                    <div class="prompt-title">Generate Single Social Media Content</div>
                    <div class="prompt-instructions">
                        <strong>üìã Instructions:</strong>
                        Add your transcript to the Chat agent before using this prompt.
                    </div>
                    <div class="prompt-text" id="prompt5">
                        Using my transcript, create me a random, social media reminder that fits to the maximum of 'x.com'.
                    </div>
                    <div class="prompt-actions">
                        <span class="copy-feedback" id="feedback5">‚úì Copied!</span>
                        <button class="btn btn-secondary btn-small" onclick="askCopilot()">Ask Copilot</button>
                        <button class="btn btn-secondary btn-small" onclick="askChatGPT()">Ask ChatGPT</button>
                        <button class="btn btn-secondary btn-small" onclick="askGemini()">Ask Gemini</button>
                        <button class="btn btn-primary btn-small" onclick="copyPrompt('prompt5', 'feedback5')">Copy Prompt</button>
                    </div>
                </div>
                </div>
            </div>
        </div>

        <!-- Tab 5: Settings -->
        <div class="tab-content">
            <div class="section">
                <div class="section-header" onclick="toggleSection('site-colouring-content')">
                    <span class="section-toggle" id="site-colouring-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Site Colouring</h2>
                </div>
                <div class="section-content" id="site-colouring-content">
                
                <!-- Theme Selection -->
                <div class="settings-option">
                    <h3>Appearance</h3>
                    <div class="theme-buttons">
                        <button class="theme-btn" data-theme="light" onclick="changeTheme('light')">‚òÄÔ∏è Light</button>
                        <button class="theme-btn" data-theme="dark" onclick="changeTheme('dark')">üåô Dark</button>
                        <button class="theme-btn active" data-theme="system" onclick="changeTheme('system')">üíª System</button>
                    </div>
                </div>

                <!-- Color Scheme Selection -->
                <div class="settings-option">
                    <h3>Main Colour Scheme</h3>
                    <div class="color-options">
                        <button class="color-btn active" data-color="purple" onclick="changeColorScheme('purple')">
                            Purple Gradient
                            <div class="color-preview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                        </button>
                        <button class="color-btn" data-color="blue" onclick="changeColorScheme('blue')">
                            Blue Gradient
                            <div class="color-preview" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);"></div>
                        </button>
                        <button class="color-btn" data-color="green" onclick="changeColorScheme('green')">
                            Green Gradient
                            <div class="color-preview" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);"></div>
                        </button>
                        <button class="color-btn" data-color="orange" onclick="changeColorScheme('orange')">
                            Orange Gradient
                            <div class="color-preview" style="background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);"></div>
                        </button>
                        <button class="color-btn" data-color="red" onclick="changeColorScheme('red')">
                            Red Gradient
                            <div class="color-preview" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);"></div>
                        </button>
                        <button class="color-btn" data-color="studiochannel84" onclick="changeColorScheme('studiochannel84')">
                            Studio:Channel84 Gradient
                            <div class="color-preview" style="background: linear-gradient(135deg, #00e887 0%, #ea00ff 100%);"></div>
                        </button>
                        <button class="color-btn" data-color="custom" onclick="changeColorScheme('custom')">
                            Custom Gradient
                            <div class="color-preview" id="customColorPreview" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);"></div>
                        </button>
                    </div>
                </div>

                <!-- Custom Color Picker -->
                <div id="customColorPicker" style="display: none; margin-top: 20px; padding: 20px; background: #f8f9fa; border-radius: 8px;">
                    <h4 style="margin: 0 0 15px 0;">Create Your Custom Gradient</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">Start Color</label>
                            <input type="color" id="customColor1" value="#667eea" onchange="updateCustomGradient()" style="width: 100%; height: 50px; border: 2px solid #dee2e6; border-radius: 8px; cursor: pointer;">
                        </div>
                        <div>
                            <label style="display: block; margin-bottom: 8px; font-weight: 600;">End Color</label>
                            <input type="color" id="customColor2" value="#764ba2" onchange="updateCustomGradient()" style="width: 100%; height: 50px; border: 2px solid #dee2e6; border-radius: 8px; cursor: pointer;">
                        </div>
                    </div>
                    <button class="btn btn-primary" onclick="applyCustomGradient()" style="margin-top: 15px; width: 100%;">Apply Custom Gradient</button>
                </div>
                </div>
            </div>

            <div class="section">
                <div class="section-header" onclick="toggleSection('storage-usage-content')">
                    <span class="section-toggle" id="storage-usage-content-toggle">‚àí</span>
                    <h2 style="margin: 0;">Storage & Data Management</h2>
                </div>
                <div class="section-content" id="storage-usage-content">
                    <p style="color: #6c757d; margin-bottom: 15px;">Your data is stored locally in your browser. Here's how much space you're using:</p>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid var(--primary-color); margin-bottom: 20px;">
                        <div style="margin-bottom: 10px;">
                            <strong>Total Storage Used:</strong> <span id="storageSize" style="color: var(--primary-color); font-size: 18px; font-weight: bold;">Calculating...</span>
                        </div>
                        <div style="font-size: 14px; color: #6c757d;">
                            <strong>Breakdown:</strong>
                            <ul style="margin: 10px 0; padding-left: 20px;">
                                <li>Episode Details: <span id="episodeDetailsSize">-</span></li>
                                <li>People: <span id="peopleSize">-</span></li>
                                <li>Assets: <span id="assetsSize">-</span></li>
                                <li>Segments: <span id="segmentsSize">-</span></li>
                                <li>Settings: <span id="settingsSize">-</span></li>
                            </ul>
                        </div>
                        <button class="btn btn-primary" onclick="calculateStorageUsage()" style="margin-top: 10px;">‚Üª Refresh Storage Info</button>
                    </div>
                    
                    <div style="background: #fff3cd; padding: 20px; border-radius: 8px; border-left: 4px solid #dc3545;">
                        <h3 style="margin: 0 0 10px 0; color: #721c24;">‚ö†Ô∏è Reset Application</h3>
                        <p style="color: #856404; margin-bottom: 15px;">
                            This will completely reset Podcast Planner by clearing all your data from localStorage. 
                            <strong>This action cannot be undone!</strong>
                        </p>
                        <p style="color: #856404; margin-bottom: 15px;">
                            Before resetting, make sure to export your current episode as JSON if you want to keep a backup.
                        </p>
                        <button class="btn btn-danger" onclick="resetPodcastPlanner()" style="font-weight: bold;">üóëÔ∏è Reset Podcast Planner</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="version">Version 1.78</div>

    <script>
        // Data storage
        let people = [];
        let assets = [];
        let segments = [];
        let segmentsCollapsed = false;
        let episodeDetails = {
            title: '',
            number: '',
            season: '',
            recordingDate: '',
            airDate: ''
        };
        let settings = {
            theme: 'system',
            colorScheme: 'purple'
        };
        
        // Go Live state
        let currentSegmentIndex = 0;
        let timerInterval = null;
        let timerSeconds = 0;
        let timerRunning = false;

        // Section collapse functionality
        function toggleSection(sectionId) {
            const content = document.getElementById(sectionId);
            const toggle = document.getElementById(sectionId + '-toggle');
            
            if (content.classList.contains('collapsed')) {
                content.classList.remove('collapsed');
                toggle.textContent = '‚àí';
            } else {
                content.classList.add('collapsed');
                toggle.textContent = '+';
            }
        }

        // Color schemes
        const colorSchemes = {
            purple: { primary: '#667eea', secondary: '#764ba2' },
            blue: { primary: '#4facfe', secondary: '#00f2fe' },
            green: { primary: '#43e97b', secondary: '#38f9d7' },
            orange: { primary: '#fa709a', secondary: '#fee140' },
            red: { primary: '#f093fb', secondary: '#f5576c' },
            teal: { primary: '#4facfe', secondary: '#00f2fe' },
            studiochannel84: { primary: '#00e887', secondary: '#ea00ff' }
        };

        // Dark versions of color schemes (darker, muted versions)
        const darkColorSchemes = {
            purple: { primary: '#3d4a8a', secondary: '#4a2d61' },
            blue: { primary: '#2e6a9e', secondary: '#006b7d' },
            green: { primary: '#2a8a4d', secondary: '#22826e' },
            orange: { primary: '#9a3d59', secondary: '#9a7d28' },
            red: { primary: '#905c9b', secondary: '#923642' },
            teal: { primary: '#2e6a9e', secondary: '#006b7d' },
            studiochannel84: { primary: '#005b35', secondary: '#750080' }
        };

        // Apply theme
        function applyTheme(theme) {
            if (theme === 'system') {
                const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.body.classList.toggle('dark-mode', prefersDark);
            } else if (theme === 'dark') {
                document.body.classList.add('dark-mode');
            } else {
                document.body.classList.remove('dark-mode');
            }
            // Reapply color scheme to use correct light/dark version
            applyColorScheme(settings.colorScheme);
        }

        // Change theme
        function changeTheme(theme) {
            settings.theme = theme;
            applyTheme(theme);
            
            // Update active button
            document.querySelectorAll('.theme-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.theme === theme);
            });
            
            saveSettings();
        }

        // Apply color scheme
        function applyColorScheme(scheme) {
            if (scheme === 'custom' && settings.customColor1 && settings.customColor2) {
                // Use custom colors
                document.documentElement.style.setProperty('--primary-color', settings.customColor1);
                document.documentElement.style.setProperty('--secondary-color', settings.customColor2);
            } else {
                const isDarkMode = document.body.classList.contains('dark-mode');
                const colors = isDarkMode ? darkColorSchemes[scheme] : colorSchemes[scheme];
                
                if (colors) {
                    document.documentElement.style.setProperty('--primary-color', colors.primary);
                    document.documentElement.style.setProperty('--secondary-color', colors.secondary);
                }
            }
        }

        // Update custom gradient preview
        function updateCustomGradient() {
            const color1 = document.getElementById('customColor1').value;
            const color2 = document.getElementById('customColor2').value;
            const preview = document.getElementById('customColorPreview');
            preview.style.background = `linear-gradient(135deg, ${color1} 0%, ${color2} 100%)`;
        }

        // Apply custom gradient
        function applyCustomGradient() {
            const color1 = document.getElementById('customColor1').value;
            const color2 = document.getElementById('customColor2').value;
            
            // Save to settings
            settings.customColor1 = color1;
            settings.customColor2 = color2;
            
            // Apply the colors
            applyColorScheme('custom');
            saveSettings();
            
            alert('Custom gradient applied successfully!');
        }

        // Change color scheme
        function changeColorScheme(scheme) {
            settings.colorScheme = scheme;
            
            // Show/hide custom color picker
            const customColorPicker = document.getElementById('customColorPicker');
            if (scheme === 'custom') {
                customColorPicker.style.display = 'block';
                // Load saved custom colors if available
                if (settings.customColor1 && settings.customColor2) {
                    document.getElementById('customColor1').value = settings.customColor1;
                    document.getElementById('customColor2').value = settings.customColor2;
                    updateCustomGradient();
                }
            } else {
                customColorPicker.style.display = 'none';
            }
            
            applyColorScheme(scheme);
            
            // Update active button
            document.querySelectorAll('.color-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.color === scheme);
            });
            
            saveSettings();
        }

        // Save settings to localStorage
        function saveSettings() {
            try {
                localStorage.setItem('podcastPlannerSettings', JSON.stringify(settings));
            } catch (e) {
                console.error('Error saving settings:', e);
            }
        }

        // Load settings from localStorage
        function loadSettings() {
            try {
                const savedSettings = localStorage.getItem('podcastPlannerSettings');
                if (savedSettings) {
                    settings = JSON.parse(savedSettings);
                    applyTheme(settings.theme);
                    applyColorScheme(settings.colorScheme);
                    
                    // Update UI buttons
                    document.querySelectorAll('.theme-btn').forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.theme === settings.theme);
                    });
                    document.querySelectorAll('.color-btn').forEach(btn => {
                        btn.classList.toggle('active', btn.dataset.color === settings.colorScheme);
                    });
                    
                    // Show custom color picker if custom scheme is selected
                    if (settings.colorScheme === 'custom') {
                        const customColorPicker = document.getElementById('customColorPicker');
                        if (customColorPicker) {
                            customColorPicker.style.display = 'block';
                            if (settings.customColor1 && settings.customColor2) {
                                document.getElementById('customColor1').value = settings.customColor1;
                                document.getElementById('customColor2').value = settings.customColor2;
                                updateCustomGradient();
                            }
                        }
                    }
                }
            } catch (e) {
                console.error('Error loading settings:', e);
            }
        }

        // Listen for system theme changes
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', (e) => {
            if (settings.theme === 'system') {
                applyTheme('system');
            }
        });

        // Check screen size and show warning if too small
        function checkScreenSize() {
            const mobileWarning = document.getElementById('mobileWarning');
            const container = document.querySelector('.container');
            
            // Show warning if width is less than 768px (tablet breakpoint)
            if (window.innerWidth < 768) {
                mobileWarning.classList.add('active');
                container.style.display = 'none';
            } else {
                mobileWarning.classList.remove('active');
                container.style.display = 'block';
            }
        }

        // Load data from cookies on page load
        window.onload = function() {
            checkScreenSize();
            loadSettings();
            loadFromCookies();
            renderPeople();
            renderAssets();
            renderSegments();
            renderAddedSegmentsList();
            renderPlannerPeople();
            renderPlannerAssets();
            updateCalculator();
            loadEpisodeDetails();
            calculateStorageUsage();
        };

        // Re-check on window resize
        window.addEventListener('resize', checkScreenSize);

        // Tab switching
        function switchTab(tabIndex) {
            const tabs = document.querySelectorAll('.tab');
            const contents = document.querySelectorAll('.tab-content');
            
            tabs.forEach((tab, index) => {
                if (index === tabIndex) {
                    tab.classList.add('active');
                    contents[index].classList.add('active');
                } else {
                    tab.classList.remove('active');
                    contents[index].classList.remove('active');
                }
            });

            // Update displays when switching tabs
            if (tabIndex === 0) {
                renderAddedSegmentsList();
            }
            if (tabIndex === 1) {
                renderSegments();
                updateCalculator();
                renderPlannerPeople();
            }
            if (tabIndex === 2) {
                initializeGoLive();
            }
        }

        // Character counter for description
        function updateCharCounter() {
            const description = document.getElementById('segmentDescription').value;
            document.getElementById('charCounter').textContent = `${description.length} / 500`;
        }

        // Add person
        function addPerson() {
            const name = document.getElementById('personName').value.trim();
            const isHost = document.getElementById('roleHost').checked;
            const isGuest = document.getElementById('roleGuest').checked;
            const isProducer = document.getElementById('roleProducer').checked;
            const color = document.getElementById('personColor').value;

            if (!name) {
                alert('Please enter a name');
                return;
            }

            if (!isHost && !isGuest && !isProducer) {
                alert('Please select at least one role');
                return;
            }

            const roles = [];
            if (isHost) roles.push('host');
            if (isGuest) roles.push('guest');
            if (isProducer) roles.push('producer');

            people.push({ name, roles, color });
            
            console.log('Person added:', { name, roles, color });
            console.log('People array now:', people);
            
            // Clear form
            document.getElementById('personName').value = '';
            document.getElementById('roleHost').checked = false;
            document.getElementById('roleGuest').checked = false;
            document.getElementById('roleProducer').checked = false;
            document.getElementById('personColor').value = '#667eea';

            saveToCookies();
            renderPeople();
            renderPlannerPeople();
        }

        // Remove person
        function removePerson(index) {
            people.splice(index, 1);
            saveToCookies();
            renderPeople();
            renderPlannerPeople();
            renderSegments(); // Update segments display
        }

        // Render people list
        function renderPeople() {
            const container = document.getElementById('peopleList');
            
            if (people.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No hosts, guests, or producers added yet</p></div>';
                return;
            }

            container.innerHTML = people.map((person, index) => `
                <div class="person-item" style="border-color: ${person.color || '#dee2e6'}">
                    <div class="person-color-bar" style="background: ${person.color || '#667eea'}"></div>
                    <div class="person-info">
                        <strong>${person.name}</strong>
                        <div class="person-badges">
                            ${person.roles.map(role => `
                                <span class="badge badge-custom" style="background: ${person.color || '#667eea'}">${role.charAt(0).toUpperCase() + role.slice(1)}</span>
                            `).join('')}
                        </div>
                    </div>
                    <button class="btn btn-danger btn-small" onclick="removePerson(${index})">Remove</button>
                </div>
            `).join('');
        }

        // Add asset
        function addAsset() {
            const name = document.getElementById('assetName').value.trim();
            const color = document.getElementById('assetColor').value;

            if (!name) {
                alert('Please enter an asset name');
                return;
            }

            assets.push({ name, color });
            
            console.log('Asset added:', { name, color });
            console.log('Assets array now:', assets);
            
            // Clear form
            document.getElementById('assetName').value = '';
            document.getElementById('assetColor').value = '#43e97b';

            saveToCookies();
            renderAssets();
            renderPlannerAssets();
        }

        // Remove asset
        function removeAsset(index) {
            assets.splice(index, 1);
            saveToCookies();
            renderAssets();
            renderPlannerAssets();
            renderSegments(); // Update segments display
        }

        // Render assets list
        function renderAssets() {
            const container = document.getElementById('assetsList');
            
            if (assets.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No assets added yet</p></div>';
                return;
            }

            container.innerHTML = assets.map((asset, index) => `
                <div class="person-item" style="border-color: ${asset.color || '#dee2e6'}">
                    <div class="person-color-bar" style="background: ${asset.color || '#43e97b'}"></div>
                    <div class="person-info">
                        <strong>${asset.name}</strong>
                    </div>
                    <button class="btn btn-danger btn-small" onclick="removeAsset(${index})">Remove</button>
                </div>
            `).join('');
        }

        // Add key point
        function addKeyPoint() {
            const container = document.getElementById('keyPointsContainer');
            
            // Find all existing key point items
            const existingItems = container.querySelectorAll('.key-point-item');
            
            // Replace the Add button with Remove button in all existing items
            existingItems.forEach(item => {
                const button = item.querySelector('button');
                if (button && button.textContent === 'Add') {
                    button.textContent = 'Remove';
                    button.className = 'btn btn-danger btn-small';
                    button.setAttribute('onclick', 'removeKeyPoint(this)');
                }
            });
            
            // Create new key point with Add button
            const newKeyPoint = document.createElement('div');
            newKeyPoint.className = 'key-point-item';
            newKeyPoint.innerHTML = `
                <input type="text" class="key-point-input" placeholder="Enter key point">
                <button class="btn btn-primary btn-small" onclick="addKeyPoint()">Add</button>
            `;
            container.appendChild(newKeyPoint);
        }

        // Remove key point
        function removeKeyPoint(button) {
            const container = document.getElementById('keyPointsContainer');
            const items = container.querySelectorAll('.key-point-item');
            
            // Don't allow removing if it's the last item
            if (items.length <= 1) {
                alert('You must have at least one key point field');
                return;
            }
            
            button.parentElement.remove();
        }

        // Add segment
        function addSegment() {
            const title = document.getElementById('segmentTitle').value.trim();
            const description = document.getElementById('segmentDescription').value.trim();
            const time = parseInt(document.getElementById('estimatedTime').value);

            if (!title) {
                alert('Please enter a segment title');
                return;
            }

            if (!time || time <= 0) {
                alert('Please enter a valid estimated time');
                return;
            }

            // Get all key points
            const keyPointInputs = document.querySelectorAll('.key-point-input');
            const keyPoints = Array.from(keyPointInputs)
                .map(input => input.value.trim())
                .filter(point => point !== '');

            segments.push({
                title,
                description,
                keyPoints,
                time,
                assignedPeople: [],
                assignedAssets: [],
                recordingNotes: '',
                recordedTime: 0,
                isRecorded: false
            });

            console.log('Segment added:', { title, description, keyPoints, time });
            console.log('Segments array now:', segments);

            // Clear form
            document.getElementById('segmentTitle').value = '';
            document.getElementById('segmentDescription').value = '';
            document.getElementById('estimatedTime').value = '';
            document.getElementById('keyPointsContainer').innerHTML = `
                <div class="key-point-item">
                    <input type="text" class="key-point-input" placeholder="Enter key point">
                    <button class="btn btn-primary btn-small" onclick="addKeyPoint()">Add</button>
                </div>
            `;
            updateCharCounter();

            saveToCookies();
            renderAddedSegmentsList();
        }

        // Assign person to segment
        function assignPersonToSegment(segmentIndex) {
            if (people.length === 0) {
                alert('Please add hosts, guests, or producers first in the Planner Details tab');
                return;
            }

            const select = document.getElementById(`person-select-${segmentIndex}`);
            const selectedIndex = parseInt(select.value);

            if (selectedIndex === -1) {
                return;
            }

            // Handle "Add Everyone" option
            if (selectedIndex === -2) {
                people.forEach(person => {
                    // Check if person is already assigned
                    if (!segments[segmentIndex].assignedPeople.some(p => p.name === person.name)) {
                        segments[segmentIndex].assignedPeople.push(person);
                    }
                });
                saveToCookies();
                renderSegments();
                return;
            }

            const person = people[selectedIndex];
            
            // Check if person is already assigned
            if (segments[segmentIndex].assignedPeople.some(p => p.name === person.name)) {
                alert('This person is already assigned to this segment');
                return;
            }

            segments[segmentIndex].assignedPeople.push(person);
            saveToCookies();
            renderSegments();
        }

        // Remove person from segment
        function removePersonFromSegment(segmentIndex, personIndex) {
            segments[segmentIndex].assignedPeople.splice(personIndex, 1);
            saveToCookies();
            renderSegments();
        }

        // Assign asset to segment
        function assignAssetToSegment(segmentIndex) {
            if (assets.length === 0) {
                alert('Please add assets first in the Planner Details tab');
                return;
            }

            const select = document.getElementById(`asset-select-${segmentIndex}`);
            const selectedIndex = parseInt(select.value);

            if (selectedIndex === -1) {
                return;
            }

            // Ensure assignedAssets array exists
            if (!segments[segmentIndex].assignedAssets) {
                segments[segmentIndex].assignedAssets = [];
            }

            // Handle "Add All" option
            if (selectedIndex === -2) {
                assets.forEach(asset => {
                    // Check if asset is already assigned
                    if (!segments[segmentIndex].assignedAssets.some(a => a.name === asset.name)) {
                        segments[segmentIndex].assignedAssets.push(asset);
                    }
                });
                saveToCookies();
                renderSegments();
                return;
            }

            const asset = assets[selectedIndex];
            
            // Check if asset is already assigned
            if (segments[segmentIndex].assignedAssets.some(a => a.name === asset.name)) {
                alert('This asset is already assigned to this segment');
                return;
            }

            segments[segmentIndex].assignedAssets.push(asset);
            saveToCookies();
            renderSegments();
        }

        // Remove asset from segment
        function removeAssetFromSegment(segmentIndex, assetIndex) {
            segments[segmentIndex].assignedAssets.splice(assetIndex, 1);
            saveToCookies();
            renderSegments();
        }

        // Remove segment
        function removeSegment(index) {
            if (confirm('Are you sure you want to remove this segment?')) {
                segments.splice(index, 1);
                saveToCookies();
                renderSegments();
                renderAddedSegmentsList();
                updateCalculator();
            }
        }

        // Render segments
        function renderSegments() {
            const container = document.getElementById('segmentList');
            
            if (segments.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No segments added yet. Go to Planner Details tab to add segments.</p></div>';
                return;
            }

            container.innerHTML = segments.map((segment, index) => `
                <div class="segment-item${segmentsCollapsed ? ' collapsed' : ''}" draggable="true" data-index="${index}" 
                     ondragstart="handleDragStart(event)" 
                     ondragend="handleDragEnd(event)" 
                     ondragover="handleDragOver(event)" 
                     ondrop="handleDrop(event)" 
                     ondragleave="handleDragLeave(event)">
                    <div class="segment-header">
                        <div class="segment-title">
                            <span class="drag-handle">‚ãÆ‚ãÆ</span>
                            ${segment.title}
                        </div>
                        <div class="segment-time">${segment.time} min</div>
                    </div>
                    ${segment.description ? `<div class="segment-description">${segment.description}</div>` : ''}
                    ${segment.keyPoints.length > 0 ? `
                        <div class="segment-key-points">
                            <strong>Key Points:</strong>
                            <ul style="margin-top: 8px;">
                                ${segment.keyPoints.map(point => `<li>${point}</li>`).join('')}
                            </ul>
                        </div>
                    ` : ''}
                    <div class="segment-people">
                        <strong>Assigned People:</strong>
                        <div class="segment-people-list">
                            ${segment.assignedPeople.length > 0 ? segment.assignedPeople.map((person, personIndex) => `
                                <div class="person-item" style="margin-bottom: 0; border-color: ${person.color || '#dee2e6'}; padding: 12px;">
                                    <div class="person-color-bar" style="background: ${person.color || '#667eea'}"></div>
                                    <div class="person-info">
                                        <strong>${person.name}</strong>
                                        <div class="person-badges">
                                            ${person.roles.map(role => `
                                                <span class="badge badge-custom" style="background: ${person.color || '#667eea'}">${role.charAt(0).toUpperCase() + role.slice(1)}</span>
                                            `).join('')}
                                        </div>
                                    </div>
                                    <button class="btn btn-danger btn-small" onclick="removePersonFromSegment(${index}, ${personIndex})">Remove</button>
                                </div>
                            `).join('') : '<em style="color: #6c757d;">No one assigned yet</em>'}
                        </div>
                        ${(segment.assignedAssets && segment.assignedAssets.length > 0) || assets.length > 0 ? `
                            <div style="margin-top: 12px;">
                                <strong>Assets:</strong>
                                <div class="segment-assets-list" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 8px;">
                                    ${segment.assignedAssets && segment.assignedAssets.length > 0 ? segment.assignedAssets.map((asset, assetIndex) => `
                                        <div class="asset-pill" style="background: ${asset.color || '#43e97b'}; color: white; padding: 6px 12px; border-radius: 20px; display: inline-flex; align-items: center; gap: 8px; font-size: 14px;">
                                            ${asset.name}
                                            <button class="btn-pill-remove" onclick="removeAssetFromSegment(${index}, ${assetIndex})" style="background: rgba(255,255,255,0.2); border: none; color: white; width: 18px; height: 18px; border-radius: 50%; cursor: pointer; display: flex; align-items: center; justify-content: center; padding: 0; font-size: 12px;">√ó</button>
                                        </div>
                                    `).join('') : '<em style="color: #6c757d;">No assets assigned</em>'}
                                </div>
                            </div>
                        ` : ''}
                    </div>
                    <div class="segment-actions">
                        <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center;">
                            <select id="person-select-${index}">
                                <option value="-1">Select person to add...</option>
                                <option value="-2">Add Everyone</option>
                                ${people.map((person, personIndex) => `
                                    <option value="${personIndex}">${person.name} (${person.roles.join(', ')})</option>
                                `).join('')}
                            </select>
                            <button class="btn btn-primary" onclick="assignPersonToSegment(${index})">Add Host / Guest</button>
                        </div>
                        ${assets.length > 0 ? `
                            <div style="display: grid; grid-template-columns: 1fr auto; gap: 10px; align-items: center;">
                                <select id="asset-select-${index}">
                                    <option value="-1">Select asset to add...</option>
                                    <option value="-2">Add All</option>
                                    ${assets.map((asset, assetIndex) => `
                                        <option value="${assetIndex}">${asset.name}</option>
                                    `).join('')}
                                </select>
                                <button class="btn btn-primary" onclick="assignAssetToSegment(${index})">Add Asset</button>
                            </div>
                        ` : ''}
                        <button class="btn btn-danger" onclick="removeSegment(${index})" style="margin-top: 10px;">Remove Segment</button>
                    </div>
                </div>
            `).join('');
        }

        // Toggle collapse/expand all segments
        function toggleCollapseAll() {
            segmentsCollapsed = !segmentsCollapsed;
            const button = document.getElementById('toggleCollapseBtn');
            const segmentItems = document.querySelectorAll('.segment-item');
            
            if (segmentsCollapsed) {
                button.textContent = 'Expand All';
                segmentItems.forEach(item => item.classList.add('collapsed'));
            } else {
                button.textContent = 'Collapse All';
                segmentItems.forEach(item => item.classList.remove('collapsed'));
            }
        }

        // Update calculator
        function updateCalculator() {
            const segmentCount = segments.length;
            const totalRuntime = segments.reduce((sum, segment) => sum + segment.time, 0);

            document.getElementById('segmentCount').textContent = segmentCount;
            document.getElementById('totalRuntime').textContent = totalRuntime;
        }

        // Go Live Functions
        function startTimer() {
            if (!timerRunning) {
                timerRunning = true;
                timerInterval = setInterval(() => {
                    timerSeconds++;
                    updateTimerDisplay();
                }, 1000);
            }
        }

        function pauseTimer() {
            if (timerRunning) {
                timerRunning = false;
                clearInterval(timerInterval);
            }
        }

        function stopTimer() {
            if (timerRunning) {
                timerRunning = false;
                clearInterval(timerInterval);
            }
            
            // Save the timer value to the current segment
            if (segments.length > 0 && timerSeconds > 0) {
                const segment = segments[currentSegmentIndex];
                segment.recordedTime = timerSeconds;
                segment.isRecorded = true;
                updateRecordedTimeDisplay(segment);
                saveToCookies();
                updateGoLiveStats();
            }
        }

        function resetTimer() {
            if (confirm('Are you sure? This will remove the recorded time from this segment and set the timer to zero.')) {
                pauseTimer();
                timerSeconds = 0;
                updateTimerDisplay();
                
                // Clear recorded time for current segment
                if (segments.length > 0) {
                    const segment = segments[currentSegmentIndex];
                    segment.recordedTime = 0;
                    segment.isRecorded = false;
                    updateRecordedTimeDisplay(segment);
                    saveToCookies();
                    updateGoLiveStats();
                }
            }
        }

        function updateTimerDisplay() {
            const hours = Math.floor(timerSeconds / 3600);
            const minutes = Math.floor((timerSeconds % 3600) / 60);
            const seconds = timerSeconds % 60;
            
            const display = `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
            document.getElementById('timerDisplay').textContent = display;
        }

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = seconds % 60;
            return `${String(hours).padStart(2, '0')}:${String(minutes).padStart(2, '0')}:${String(secs).padStart(2, '0')}`;
        }

        function updateGoLiveStats() {
            const estimatedTime = segments.reduce((sum, s) => sum + s.time, 0);
            const totalRecordedTime = segments.reduce((sum, s) => sum + (s.recordedTime || 0), 0);
            const recordedCount = segments.filter(s => s.isRecorded).length;
            const leftCount = segments.length - recordedCount;

            document.getElementById('goLiveEstimatedTime').textContent = estimatedTime + ' min';
            document.getElementById('goLiveTotalTime').textContent = formatTime(totalRecordedTime);
            document.getElementById('goLiveTotalSegments').textContent = segments.length;
            document.getElementById('goLiveRecorded').textContent = recordedCount;
            document.getElementById('goLiveLeft').textContent = leftCount;
        }

        function updateRecordedTimeDisplay(segment) {
            const recordedTimeField = document.getElementById('recordedTime');
            const recordedSeconds = segment.recordedTime || 0;
            const estimatedSeconds = segment.time * 60; // Convert minutes to seconds
            
            recordedTimeField.value = formatTime(recordedSeconds);
            
            if (recordedSeconds === 0) {
                // No recorded time yet
                recordedTimeField.style.background = '#e9ecef';
                recordedTimeField.style.border = '1px solid #ced4da';
            } else {
                const percentDiff = Math.abs(recordedSeconds - estimatedSeconds) / estimatedSeconds;
                
                if (percentDiff <= 0.10) {
                    // Within 10%
                    recordedTimeField.style.background = '#fff3cd';
                    recordedTimeField.style.border = '2px solid #856404';
                } else if (recordedSeconds < estimatedSeconds) {
                    // Under time
                    recordedTimeField.style.background = '#d4edda';
                    recordedTimeField.style.border = '2px solid #28a745';
                } else {
                    // Over time
                    recordedTimeField.style.background = '#f8d7da';
                    recordedTimeField.style.border = '2px solid #dc3545';
                }
            }
        }

        function updateRecordedTimeDisplay(segment) {
            const recordedTimeField = document.getElementById('recordedTime');
            const recordedSeconds = segment.recordedTime || 0;
            const estimatedSeconds = segment.time * 60; // Convert minutes to seconds
            
            recordedTimeField.value = formatTime(recordedSeconds);
            
            if (recordedSeconds === 0) {
                // No recorded time yet
                recordedTimeField.style.background = '#e9ecef';
                recordedTimeField.style.border = '1px solid #ced4da';
            } else {
                const percentDiff = Math.abs(recordedSeconds - estimatedSeconds) / estimatedSeconds;
                
                if (percentDiff <= 0.10) {
                    // Within 10%
                    recordedTimeField.style.background = '#fff3cd';
                    recordedTimeField.style.border = '2px solid #856404';
                } else if (recordedSeconds < estimatedSeconds) {
                    // Under time
                    recordedTimeField.style.background = '#d4edda';
                    recordedTimeField.style.border = '2px solid #28a745';
                } else {
                    // Over time
                    recordedTimeField.style.background = '#f8d7da';
                    recordedTimeField.style.border = '2px solid #dc3545';
                }
            }
        }

        function displayCurrentSegment() {
            if (segments.length === 0) {
                document.getElementById('currentSegmentDisplay').innerHTML = '<p style="color: #6c757d; text-align: center;">No segments available. Add segments in the Planner Details tab.</p>';
                document.getElementById('segmentControls').style.display = 'none';
                return;
            }

            const segment = segments[currentSegmentIndex];
            document.getElementById('segmentControls').style.display = 'block';
            
            let html = `
                <div style="margin-bottom: 15px;">
                    <h3 style="margin: 0 0 10px 0; color: var(--primary-color);">Segment ${currentSegmentIndex + 1} of ${segments.length}</h3>
                    <h4 style="margin: 0 0 10px 0; color: #495057;">${segment.title}</h4>
                    <p style="color: #6c757d; margin: 0 0 10px 0;"><strong>Estimated Time:</strong> ${segment.time} minutes</p>
                </div>
            `;
            
            if (segment.description) {
                html += `<div style="margin-bottom: 10px;"><strong>Description:</strong><br>${segment.description}</div>`;
            }
            
            if (segment.keyPoints && segment.keyPoints.length > 0) {
                html += '<div style="margin-bottom: 10px;"><strong>Key Points:</strong><ul style="margin: 5px 0; padding-left: 25px;">';
                segment.keyPoints.forEach(point => {
                    html += `<li>${point}</li>`;
                });
                html += '</ul></div>';
            }
            
            if (segment.assignedPeople && segment.assignedPeople.length > 0) {
                html += '<div style="margin-bottom: 10px;"><strong>People:</strong> ';
                html += segment.assignedPeople.map(p => p.name).join(', ');
                html += '</div>';
            }
            
            if (segment.assignedAssets && segment.assignedAssets.length > 0) {
                html += '<div><strong>Assets:</strong> ';
                html += segment.assignedAssets.map(a => a.name).join(', ');
                html += '</div>';
            }
            
            document.getElementById('currentSegmentDisplay').innerHTML = html;
            document.getElementById('recordingNotes').value = segment.recordingNotes || '';
            updateRecordedTimeDisplay(segment);
            
            // Update button states
            document.getElementById('prevSegmentBtn').disabled = currentSegmentIndex === 0;
            document.getElementById('nextSegmentBtnPlain').disabled = currentSegmentIndex === segments.length - 1;
            document.getElementById('nextSegmentBtn').textContent = currentSegmentIndex === segments.length - 1 ? 'Save' : 'Save & Next ‚Üí';
        }

        function previousSegment() {
            if (currentSegmentIndex > 0) {
                saveCurrentSegmentData();
                currentSegmentIndex--;
                // Just pause and reset timer display without confirmation
                pauseTimer();
                timerSeconds = 0;
                updateTimerDisplay();
                displayCurrentSegment();
            }
        }

        function nextSegment() {
            if (currentSegmentIndex < segments.length - 1) {
                // Check if notes have been entered but not saved
                const notesBox = document.getElementById('recordingNotes');
                const notes = notesBox ? notesBox.value.trim() : '';
                const segment = segments[currentSegmentIndex];
                const savedNotes = segment && segment.recordingNotes ? segment.recordingNotes.trim() : '';
                if (notes && notes !== savedNotes) {
                    if (!confirm('You have entered notes for this segment that have not been saved.\nIf you continue, your notes will be lost.\n\nTo save your notes, click Save & Next instead.\n\nAre you sure you want to continue without saving?')) {
                        return;
                    }
                }
                currentSegmentIndex++;
                // Just pause and reset timer display without confirmation
                pauseTimer();
                timerSeconds = 0;
                updateTimerDisplay();
                displayCurrentSegment();
            }
        }

        function saveAndNextSegment() {
            saveCurrentSegmentData();
            alert('Notes and recorded time saved.');
            if (currentSegmentIndex < segments.length - 1) {
                currentSegmentIndex++;
                // Reset timer without confirmation dialog
                pauseTimer();
                timerSeconds = 0;
                updateTimerDisplay();
                displayCurrentSegment();
            }
        }

        function saveCurrentSegmentData() {
            if (segments.length === 0) return;
            
            const segment = segments[currentSegmentIndex];
            segment.recordingNotes = document.getElementById('recordingNotes').value;
            
            // Save timer value if it was running or has time
            if (timerSeconds > 0) {
                segment.recordedTime = timerSeconds;
                segment.isRecorded = true;
            }
            
            saveToCookies();
            updateGoLiveStats();
        }

        function initializeGoLive() {
            if (segments.length > 0) {
                displayCurrentSegment();
                updateGoLiveStats();
            }
        }

        // Export Go Live functions
        // Clear people
        function clearEpisodeDetails() {
            if (confirm('Are you sure you want to clear all episode details?')) {
                episodeDetails = {
                    title: '',
                    number: '',
                    season: '',
                    recordingDate: '',
                    airDate: ''
                };
                saveToCookies();
                loadEpisodeDetails();
            }
        }

        function clearPeople() {
            if (confirm('Are you sure you want to clear all hosts, guests, and producers?')) {
                people = [];
                saveToCookies();
                renderPeople();
                renderSegments(); // Update segments to remove assigned people
            }
        }

        // Clear assets
        function clearAssets() {
            if (confirm('Are you sure you want to clear all assets?')) {
                assets = [];
                saveToCookies();
                renderAssets();
                renderPlannerAssets(); // Update Planner tab assets
                renderSegments(); // Update segments to remove assigned assets
            }
        }

        // Clear segments
        function clearSegments() {
            if (confirm('Are you sure you want to clear all segments?')) {
                segments = [];
                saveToCookies();
                renderSegments();
                updateCalculator();
            }
        }

        // Episode details
        function saveEpisodeDetails() {
            episodeDetails.title = document.getElementById('episodeTitle').value;
            episodeDetails.number = document.getElementById('episodeNumber').value;
            episodeDetails.season = document.getElementById('episodeSeason').value;
            episodeDetails.recordingDate = document.getElementById('recordingDate').value;
            episodeDetails.airDate = document.getElementById('airDate').value;
            updateEpisodeDetailsDisplay();
            saveToCookies();
        }

        function loadEpisodeDetails() {
            document.getElementById('episodeTitle').value = episodeDetails.title || '';
            document.getElementById('episodeNumber').value = episodeDetails.number || '';
            document.getElementById('episodeSeason').value = episodeDetails.season || '';
            document.getElementById('recordingDate').value = episodeDetails.recordingDate || '';
            document.getElementById('airDate').value = episodeDetails.airDate || '';
            updateEpisodeDetailsDisplay();
        }

        function updateEpisodeDetailsDisplay() {
            document.getElementById('displayEpisodeTitle').textContent = episodeDetails.title || 'Not set';
            document.getElementById('displayEpisodeNumber').textContent = episodeDetails.number || 'Not set';
            document.getElementById('displayEpisodeSeason').textContent = episodeDetails.season || 'Not set';
            
            // Format dates for display
            if (episodeDetails.recordingDate) {
                const recDate = new Date(episodeDetails.recordingDate);
                document.getElementById('displayRecordingDate').textContent = recDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            } else {
                document.getElementById('displayRecordingDate').textContent = 'Not set';
            }
            
            if (episodeDetails.airDate) {
                const aDate = new Date(episodeDetails.airDate);
                document.getElementById('displayAirDate').textContent = aDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            } else {
                document.getElementById('displayAirDate').textContent = 'Not set';
            }
        }

        // Storage management using localStorage
        function saveToCookies() {
            const data = {
                people,
                assets,
                segments,
                episodeDetails
            };
            try {
                localStorage.setItem('podcastPlannerData', JSON.stringify(data));
                console.log('Data saved successfully');
            } catch (e) {
                console.error('Error saving data:', e);
            }
        }

        function loadFromCookies() {
            try {
                const dataString = localStorage.getItem('podcastPlannerData');
                if (dataString) {
                    const data = JSON.parse(dataString);
                    people = data.people || [];
                    assets = data.assets || [];
                    segments = data.segments || [];
                    episodeDetails = data.episodeDetails || { title: '', number: '', season: '', recordingDate: '', airDate: '' };
                    console.log('Data loaded successfully:', data);
                }
            } catch (e) {
                console.error('Error loading data:', e);
            }
        }

        // Calculate storage usage
        function calculateStorageUsage() {
            function formatBytes(bytes) {
                if (bytes === 0) return '0 Bytes';
                const k = 1024;
                const sizes = ['Bytes', 'KB', 'MB'];
                const i = Math.floor(Math.log(bytes) / Math.log(k));
                return Math.round((bytes / Math.pow(k, i)) * 100) / 100 + ' ' + sizes[i];
            }

            function getSize(obj) {
                return new Blob([JSON.stringify(obj)]).size;
            }

            // Calculate individual sizes
            const episodeDetailsSize = getSize(episodeDetails);
            const peopleSize = getSize(people);
            const assetsSize = getSize(assets);
            const segmentsSize = getSize(segments);
            const settingsData = {
                settings: settings,
                mobileWarningDismissed: localStorage.getItem('mobileWarningDismissed')
            };
            const settingsSize = getSize(settingsData);

            // Calculate total
            const totalSize = episodeDetailsSize + peopleSize + assetsSize + segmentsSize + settingsSize;

            // Update UI
            document.getElementById('storageSize').textContent = formatBytes(totalSize);
            document.getElementById('episodeDetailsSize').textContent = formatBytes(episodeDetailsSize);
            document.getElementById('peopleSize').textContent = formatBytes(peopleSize);
            document.getElementById('assetsSize').textContent = formatBytes(assetsSize);
            document.getElementById('segmentsSize').textContent = formatBytes(segmentsSize);
            document.getElementById('settingsSize').textContent = formatBytes(settingsSize);
        }

        // Reset Podcast Planner
        function resetPodcastPlanner() {
            const confirmation = confirm(
                '‚ö†Ô∏è WARNING: This will permanently delete ALL your data!\n\n' +
                'This includes:\n' +
                '‚Ä¢ All episode details\n' +
                '‚Ä¢ All people (hosts, guests, producers)\n' +
                '‚Ä¢ All assets\n' +
                '‚Ä¢ All segments\n' +
                '‚Ä¢ All settings\n\n' +
                'Have you backed up your data by exporting to JSON?\n\n' +
                'Click OK to proceed with the reset, or Cancel to go back.'
            );

            if (confirmation) {
                const doubleConfirm = confirm(
                    'Are you absolutely sure?\n\n' +
                    'This action CANNOT be undone!\n\n' +
                    'Click OK to reset everything, or Cancel to keep your data.'
                );

                if (doubleConfirm) {
                    // Clear localStorage
                    localStorage.clear();
                    
                    // Reload the page
                    window.location.reload();
                }
            }
        }

        // Export functionality
        function exportAsPlainText() {
            let text = '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n';
            text += '           PODCAST PLANNER - EPISODE DETAILS\n';
            text += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
            
            // Episode Details
            if (episodeDetails.title || episodeDetails.number || episodeDetails.season || episodeDetails.recordingDate || episodeDetails.airDate) {
                text += 'EPISODE INFORMATION:\n';
                text += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
                if (episodeDetails.title) text += `Title:           ${episodeDetails.title}\n`;
                if (episodeDetails.number) text += `Number:          ${episodeDetails.number}\n`;
                if (episodeDetails.season) text += `Season:          ${episodeDetails.season}\n`;
                if (episodeDetails.recordingDate) {
                    const recDate = new Date(episodeDetails.recordingDate);
                    text += `Recording Date:  ${recDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}\n`;
                }
                if (episodeDetails.airDate) {
                    const aDate = new Date(episodeDetails.airDate);
                    text += `Air Date:        ${aDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}\n`;
                }
                text += '\n';
            }
            
            // People Involved
            if (people.length > 0) {
                text += 'PEOPLE INVOLVED:\n';
                text += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
                people.forEach(person => {
                    text += `‚Ä¢ ${person.name} - ${person.roles.join(', ')}\n`;
                });
                text += '\n';
            }
            
            // Assets
            if (assets.length > 0) {
                text += 'ASSETS:\n';
                text += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
                assets.forEach(asset => {
                    text += `‚Ä¢ ${asset.name}\n`;
                });
                text += '\n';
            }
            
            // Summary
            text += 'EPISODE SUMMARY:\n';
            text += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n';
            text += `Total Segments:    ${segments.length}\n`;
            text += `Total Runtime:     ${segments.reduce((sum, s) => sum + s.time, 0)} minutes\n`;
            text += '\n\n';
            
            // Segments
            if (segments.length > 0) {
                text += 'EPISODE SEGMENTS:\n';
                text += '‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê\n\n';
                
                segments.forEach((segment, index) => {
                    text += `${index + 1}. ${segment.title.toUpperCase()}\n`;
                    text += `   Duration: ${segment.time} minutes\n\n`;
                    
                    if (segment.description) {
                        text += `   Description:\n`;
                        text += `   ${segment.description}\n\n`;
                    }
                    
                    if (segment.keyPoints && segment.keyPoints.length > 0) {
                        text += `   Key Points:\n`;
                        segment.keyPoints.forEach(point => {
                            text += `   ‚Ä¢ ${point}\n`;
                        });
                        text += '\n';
                    }
                    
                    if (segment.assignedPeople && segment.assignedPeople.length > 0) {
                        text += `   Assigned People:\n`;
                        segment.assignedPeople.forEach(person => {
                            text += `   ‚Ä¢ ${person.name} (${person.roles.join(', ')})\n`;
                        });
                        text += '\n';
                    }
                    
                    if (segment.assignedAssets && segment.assignedAssets.length > 0) {
                        text += `   Assets:\n`;
                        segment.assignedAssets.forEach(asset => {
                            text += `   ‚Ä¢ ${asset.name}\n`;
                        });
                        text += '\n';
                    }
                    
                    if (segment.recordedTime || segment.recordingNotes) {
                        text += `   RECORDING DATA:\n`;
                        if (segment.recordedTime) {
                            text += `   Recorded Time: ${formatTime(segment.recordedTime)} (${segment.isRecorded ? 'Completed' : 'In Progress'})\n`;
                        }
                        if (segment.recordingNotes) {
                            text += `   Notes: ${segment.recordingNotes}\n`;
                        }
                        text += '\n';
                    }
                    
                    text += '‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ\n\n';
                });
            }
            
            // Download
            const blob = new Blob([text], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `podcast-planner-${episodeDetails.title || 'episode'}.txt`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function exportAsPDF() {
            // Get current color scheme (handle custom colors)
            let primaryColor, secondaryColor;
            if (settings.colorScheme === 'custom' && settings.customColor1 && settings.customColor2) {
                primaryColor = settings.customColor1;
                secondaryColor = settings.customColor2;
            } else {
                const colors = colorSchemes[settings.colorScheme] || colorSchemes.purple;
                primaryColor = colors.primary;
                secondaryColor = colors.secondary;
            }
            
            // Create a printable HTML document
            let html = `
                <!DOCTYPE html>
                <html>
                <head>
                    <meta charset="UTF-8">
                    <title>Podcast Planner - ${episodeDetails.title || 'Episode'}</title>
                    <style>
                        * {
                            -webkit-print-color-adjust: exact !important;
                            print-color-adjust: exact !important;
                            color-adjust: exact !important;
                        }
                        @page { 
                            margin: 1.5cm; 
                        }
                        body {
                            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                            color: #333;
                            line-height: 1.6;
                            width: 90%;
                            padding: 20px 0;
                            margin-left: 5%;
                            margin-right: 5%;
                        }
                        .print-button {
                            position: fixed;
                            top: 20px;
                            right: 20px;
                            background: linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%);
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 8px;
                            font-size: 16px;
                            font-weight: 600;
                            cursor: pointer;
                            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
                            z-index: 1000;
                            transition: transform 0.2s;
                        }
                        .print-button:hover {
                            transform: translateY(-2px);
                            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
                        }
                        @media print {
                            .print-button {
                                display: none;
                            }
                        }
                        .header {
                            background: linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%);
                            -webkit-print-color-adjust: exact;
                            color: white;
                            padding: 30px;
                            text-align: center;
                            border-radius: 10px;
                            margin-bottom: 30px;
                        }
                        h1 { margin: 0 0 10px 0; font-size: 32px; }
                        .subtitle { font-size: 14px; opacity: 0.9; }
                        .info-box {
                            background: #f8f9fa;
                            -webkit-print-color-adjust: exact;
                            padding: 20px;
                            border-radius: 8px;
                            margin-bottom: 20px;
                            border-left: 4px solid ${primaryColor};
                        }
                        .info-box h2 { margin-top: 0; color: ${primaryColor}; font-size: 18px; }
                        .info-item { margin: 8px 0; }
                        .info-label { font-weight: 600; color: #495057; }
                        .summary {
                            display: grid;
                            grid-template-columns: 1fr 1fr;
                            gap: 15px;
                            margin-bottom: 30px;
                        }
                        .summary-box {
                            background: ${primaryColor};
                            -webkit-print-color-adjust: exact;
                            color: white;
                            padding: 20px;
                            border-radius: 8px;
                            text-align: center;
                        }
                        .summary-label { font-size: 12px; opacity: 0.9; }
                        .summary-value { font-size: 28px; font-weight: bold; margin-top: 5px; }
                        .segment {
                            background: white;
                            border: 2px solid #dee2e6;
                            border-radius: 10px;
                            padding: 20px;
                            margin-bottom: 20px;
                            page-break-inside: avoid;
                            -webkit-print-color-adjust: exact;
                        }
                        .segment-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            margin-bottom: 15px;
                            padding-bottom: 10px;
                            border-bottom: 2px solid ${primaryColor};
                        }
                        .segment-title { font-size: 20px; font-weight: bold; color: #495057; }
                        .segment-time {
                            background: ${primaryColor};
                            -webkit-print-color-adjust: exact;
                            color: white;
                            padding: 8px 16px;
                            border-radius: 20px;
                            font-weight: 600;
                        }
                        .segment-description { color: #6c757d; margin-bottom: 15px; }
                        .key-points { margin: 15px 0; }
                        .key-points h3 { font-size: 14px; color: #495057; margin-bottom: 8px; }
                        .key-points ul { margin: 5px 0; padding-left: 25px; }
                        .key-points li { margin: 5px 0; }
                        .assigned-people { margin-top: 15px; }
                        .assigned-people h3 { font-size: 14px; color: #495057; margin-bottom: 8px; }
                        .person-badge {
                            display: inline-block;
                            padding: 6px 12px;
                            border-radius: 6px;
                            margin: 4px;
                            font-size: 12px;
                            font-weight: 600;
                            color: white;
                            -webkit-print-color-adjust: exact;
                        }
                        .footer {
                            text-align: center;
                            color: #6c757d;
                            font-size: 12px;
                            margin-top: 40px;
                            padding-top: 20px;
                            border-top: 1px solid #dee2e6;
                        }
                    </style>
                </head>
                <body>
                    <button class="print-button" onclick="window.print()">üñ®Ô∏è Print / Save as PDF</button>
                    <div class="header">
                        <h1>üéôÔ∏è Podcast Planner</h1>
                        <div class="subtitle">Episode Planning Document</div>
                    </div>
            `;
            
            // Episode Details - Always show
            html += '<div class="info-box">';
            html += '<h2>Episode Information</h2>';
            html += `<div class="info-item"><span class="info-label">Title:</span> ${episodeDetails.title || 'Not specified'}</div>`;
            html += `<div class="info-item"><span class="info-label">Episode Number:</span> ${episodeDetails.number || 'Not specified'}</div>`;
            html += `<div class="info-item"><span class="info-label">Season:</span> ${episodeDetails.season || 'Not specified'}</div>`;
            if (episodeDetails.recordingDate) {
                const recDate = new Date(episodeDetails.recordingDate);
                html += `<div class="info-item"><span class="info-label">Recording Date:</span> ${recDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>`;
            }
            if (episodeDetails.airDate) {
                const aDate = new Date(episodeDetails.airDate);
                html += `<div class="info-item"><span class="info-label">Air Date:</span> ${aDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>`;
            }
            html += '</div>';
            
            // People Involved
            if (people.length > 0) {
                html += '<div class="info-box">';
                html += '<h2>People Involved</h2>';
                people.forEach(person => {
                    const color = person.color || '#667eea';
                    html += `<span class="person-badge" style="background: ${color}">${person.name} (${person.roles.join(', ')})</span>`;
                });
                html += '</div>';
            }
            
            // Assets
            if (assets.length > 0) {
                html += '<div class="info-box">';
                html += '<h2>Assets</h2>';
                assets.forEach(asset => {
                    const color = asset.color || '#43e97b';
                    html += `<span class="person-badge" style="background: ${color}">${asset.name}</span>`;
                });
                html += '</div>';
            }
            
            // Summary
            html += '<div class="summary">';
            html += `<div class="summary-box">
                        <div class="summary-label">Total Segments</div>
                        <div class="summary-value">${segments.length}</div>
                     </div>`;
            html += `<div class="summary-box">
                        <div class="summary-label">Total Runtime</div>
                        <div class="summary-value">${segments.reduce((sum, s) => sum + s.time, 0)} min</div>
                     </div>`;
            html += '</div>';
            
            // Segments
            if (segments.length > 0) {
                html += '<h2 style="color: #667eea; margin-bottom: 20px;">Episode Segments</h2>';
                segments.forEach((segment, index) => {
                    html += `<div class="segment">`;
                    html += `<div class="segment-header">`;
                    html += `<div class="segment-title">${index + 1}. ${segment.title}</div>`;
                    html += `<div class="segment-time">${segment.time} min</div>`;
                    html += `</div>`;
                    
                    if (segment.description) {
                        html += `<div class="segment-description">${segment.description}</div>`;
                    }
                    
                    if (segment.keyPoints && segment.keyPoints.length > 0) {
                        html += '<div class="key-points">';
                        html += '<h3>Key Points:</h3>';
                        html += '<ul>';
                        segment.keyPoints.forEach(point => {
                            html += `<li>${point}</li>`;
                        });
                        html += '</ul></div>';
                    }
                    
                    if (segment.assignedPeople && segment.assignedPeople.length > 0) {
                        html += '<div class="assigned-people">';
                        html += '<h3>Assigned People:</h3>';
                        segment.assignedPeople.forEach(person => {
                            const color = person.color || '#667eea';
                            html += `<span class="person-badge" style="background: ${color}">${person.name} (${person.roles.join(', ')})</span>`;
                        });
                        html += '</div>';
                    }
                    
                    if (segment.assignedAssets && segment.assignedAssets.length > 0) {
                        html += '<div class="assigned-people">';
                        html += '<h3>Assets:</h3>';
                        segment.assignedAssets.forEach(asset => {
                            const color = asset.color || '#43e97b';
                            html += `<span class="person-badge" style="background: ${color}">${asset.name}</span>`;
                        });
                        html += '</div>';
                    }
                    
                    if (segment.recordedTime || segment.recordingNotes) {
                        html += '<div class="assigned-people" style="border-top: 2px solid #dee2e6; margin-top: 15px; padding-top: 15px;">';
                        html += '<h3>Recording Data:</h3>';
                        if (segment.recordedTime) {
                            html += `<p style="margin: 5px 0;"><strong>Recorded Time:</strong> ${formatTime(segment.recordedTime)} ${segment.isRecorded ? '(Completed)' : '(In Progress)'}</p>`;
                        }
                        if (segment.recordingNotes) {
                            html += `<p style="margin: 5px 0;"><strong>Notes:</strong> ${segment.recordingNotes}</p>`;
                        }
                        html += '</div>';
                    }
                    
                    html += '</div>';
                });
            }
            
            html += `<div class="footer">Generated by Podcast Planner Tool on ${new Date().toLocaleDateString()}</div>`;
            html += '</body></html>';
            
            // Open in new tab with print button
            const printWindow = window.open('', '_blank');
            printWindow.document.write(html);
            printWindow.document.close();
        }

        // Export as JPG functionality
        function exportAsJPG() {
            // Get current color scheme
            const colors = colorSchemes[settings.colorScheme] || colorSchemes.purple;
            const primaryColor = colors.primary;
            const secondaryColor = colors.secondary;
            
            // Create a container for export content
            const exportContainer = document.createElement('div');
            exportContainer.style.cssText = 'position: absolute; left: -9999px; top: 0; background: white; padding: 40px; font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;';
            
            // Build the export HTML
            let html = `
                <div style="max-width: 1000px;">
                    <div style="background: linear-gradient(135deg, ${primaryColor} 0%, ${secondaryColor} 100%); color: white; padding: 30px; text-align: center; border-radius: 10px; margin-bottom: 30px;">
                        <h1 style="font-size: 2.5em; margin: 0 0 10px 0;">üéôÔ∏è Podcast Planner</h1>
                        <p style="margin: 0; font-size: 1.1em;">Episode Planning Document</p>
                    </div>
                    
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid ${primaryColor};">
                        <h2 style="margin-top: 0; color: ${primaryColor}; font-size: 1.5em;">Episode Information</h2>
                        <div style="margin: 8px 0;"><strong style="color: #495057;">Title:</strong> ${episodeDetails.title || 'Not specified'}</div>
                        <div style="margin: 8px 0;"><strong style="color: #495057;">Episode Number:</strong> ${episodeDetails.number || 'Not specified'}</div>
                        <div style="margin: 8px 0;"><strong style="color: #495057;">Season:</strong> ${episodeDetails.season || 'Not specified'}</div>
            `;
            
            if (episodeDetails.recordingDate) {
                const recDate = new Date(episodeDetails.recordingDate);
                html += `<div style="margin: 8px 0;"><strong style="color: #495057;">Recording Date:</strong> ${recDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>`;
            }
            if (episodeDetails.airDate) {
                const aDate = new Date(episodeDetails.airDate);
                html += `<div style="margin: 8px 0;"><strong style="color: #495057;">Air Date:</strong> ${aDate.toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' })}</div>`;
            }
            
            html += `</div>
            `;
            
            // People Involved
            if (people.length > 0) {
                html += '<div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid ' + primaryColor + ';">';
                html += '<h2 style="margin-top: 0; color: ' + primaryColor + '; font-size: 1.5em;">People Involved</h2>';
                html += '<div style="display: flex; flex-wrap: wrap; gap: 10px;">';
                people.forEach(person => {
                    const color = person.color || primaryColor;
                    html += `<span style="display: inline-block; padding: 8px 16px; border-radius: 6px; background: ${color}; color: white; font-weight: 600; font-size: 14px;">${person.name} (${person.roles.join(', ')})</span>`;
                });
                html += '</div></div>';
            }
            
            // Assets
            if (assets.length > 0) {
                html += '<div style="background: #f8f9fa; padding: 20px; border-radius: 8px; margin-bottom: 20px; border-left: 4px solid ' + primaryColor + ';">';
                html += '<h2 style="margin-top: 0; color: ' + primaryColor + '; font-size: 1.5em;">Assets</h2>';
                html += '<div style="display: flex; flex-wrap: wrap; gap: 10px;">';
                assets.forEach(asset => {
                    const color = asset.color || '#43e97b';
                    html += `<span style="display: inline-block; padding: 8px 16px; border-radius: 6px; background: ${color}; color: white; font-weight: 600; font-size: 14px;">${asset.name}</span>`;
                });
                html += '</div></div>';
            }
            
            // Summary
            html += '<div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 30px;">';
            html += `<div style="background: ${primaryColor}; color: white; padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 12px; opacity: 0.9;">Total Segments</div>
                        <div style="font-size: 2em; font-weight: bold; margin-top: 5px;">${segments.length}</div>
                     </div>`;
            html += `<div style="background: ${primaryColor}; color: white; padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 12px; opacity: 0.9;">Total Runtime</div>
                        <div style="font-size: 2em; font-weight: bold; margin-top: 5px;">${segments.reduce((sum, s) => sum + s.time, 0)} min</div>
                     </div>`;
            html += '</div>';
            
            // Segments
            if (segments.length > 0) {
                html += '<h2 style="color: ' + primaryColor + '; margin-bottom: 20px; font-size: 1.5em;">Episode Segments</h2>';
                segments.forEach((segment, index) => {
                    html += `<div style="background: white; border: 2px solid #dee2e6; border-radius: 10px; padding: 20px; margin-bottom: 20px;">`;
                    html += `<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid ${primaryColor};">`;
                    html += `<div style="font-size: 1.3em; font-weight: bold; color: #495057;">${index + 1}. ${segment.title}</div>`;
                    html += `<div style="background: ${primaryColor}; color: white; padding: 8px 16px; border-radius: 20px; font-weight: 600;">${segment.time} min</div>`;
                    html += `</div>`;
                    
                    if (segment.description) {
                        html += `<div style="color: #6c757d; margin-bottom: 15px;">${segment.description}</div>`;
                    }
                    
                    if (segment.keyPoints && segment.keyPoints.length > 0) {
                        html += '<div style="margin: 15px 0;">';
                        html += '<h3 style="font-size: 14px; color: #495057; margin-bottom: 8px;">Key Points:</h3>';
                        html += '<ul style="margin: 5px 0; padding-left: 25px;">';
                        segment.keyPoints.forEach(point => {
                            html += `<li style="margin: 5px 0;">${point}</li>`;
                        });
                        html += '</ul></div>';
                    }
                    
                    if (segment.assignedPeople && segment.assignedPeople.length > 0) {
                        html += '<div style="margin-top: 15px;">';
                        html += '<h3 style="font-size: 14px; color: #495057; margin-bottom: 8px;">Assigned People:</h3>';
                        html += '<div style="display: flex; flex-wrap: wrap; gap: 8px;">';
                        segment.assignedPeople.forEach(person => {
                            const color = person.color || '#667eea';
                            html += `<span style="display: inline-block; padding: 6px 12px; border-radius: 6px; background: ${color}; color: white; font-weight: 600; font-size: 12px;">${person.name} (${person.roles.join(', ')})</span>`;
                        });
                        html += '</div></div>';
                    }
                    
                    if (segment.assignedAssets && segment.assignedAssets.length > 0) {
                        html += '<div style="margin-top: 15px;">';
                        html += '<h3 style="font-size: 14px; color: #495057; margin-bottom: 8px;">Assets:</h3>';
                        html += '<div style="display: flex; flex-wrap: wrap; gap: 8px;">';
                        segment.assignedAssets.forEach(asset => {
                            const color = asset.color || '#43e97b';
                            html += `<span style="display: inline-block; padding: 6px 12px; border-radius: 20px; background: ${color}; color: white; font-weight: 600; font-size: 12px;">${asset.name}</span>`;
                        });
                        html += '</div></div>';
                    }
                    
                    if (segment.recordedTime || segment.recordingNotes) {
                        html += '<div style="margin-top: 15px; border-top: 2px solid #dee2e6; padding-top: 15px;">';
                        html += '<h3 style="font-size: 14px; color: #495057; margin-bottom: 8px;">Recording Data:</h3>';
                        if (segment.recordedTime) {
                            html += `<p style="margin: 5px 0; color: #495057;"><strong>Recorded Time:</strong> ${formatTime(segment.recordedTime)} ${segment.isRecorded ? '(Completed)' : '(In Progress)'}</p>`;
                        }
                        if (segment.recordingNotes) {
                            html += `<p style="margin: 5px 0; color: #495057;"><strong>Notes:</strong> ${segment.recordingNotes}</p>`;
                        }
                        html += '</div>';
                    }
                    
                    html += '</div>';
                });
            }
            
            html += `<div style="text-align: center; color: #6c757d; font-size: 12px; margin-top: 40px; padding-top: 20px; border-top: 1px solid #dee2e6;">Generated by Podcast Planner Tool on ${new Date().toLocaleDateString()}</div>`;
            html += '</div>';
            
            exportContainer.innerHTML = html;
            document.body.appendChild(exportContainer);
            
            // Use html2canvas to capture the content
            html2canvas(exportContainer.firstElementChild, {
                scale: 3, // High DPI
                backgroundColor: '#ffffff',
                logging: false,
                useCORS: true
            }).then(canvas => {
                // Convert to JPG
                canvas.toBlob(function(blob) {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `podcast-planner-${episodeDetails.title || 'episode'}-${new Date().toISOString().split('T')[0]}.jpg`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    // Clean up
                    document.body.removeChild(exportContainer);
                }, 'image/jpeg', 0.95);
            }).catch(err => {
                console.error('Error generating image:', err);
                alert('Failed to generate image. Please try again.');
                document.body.removeChild(exportContainer);
            });
        }

        // JSON Export/Import functionality
        function exportAsJSON() {
            const data = {
                people,
                assets,
                segments,
                episodeDetails,
                exportDate: new Date().toISOString()
            };
            
            const jsonString = JSON.stringify(data, null, 2);
            const blob = new Blob([jsonString], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `podcast-planner-${episodeDetails.title || 'show'}-${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function importFromJSON() {
            document.getElementById('jsonFileInput').click();
        }

        function handleJSONImport(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    // Validate data structure
                    if (!data.people || !data.segments || !data.episodeDetails) {
                        alert('Invalid JSON file format. Please select a valid Podcast Planner export file.');
                        return;
                    }
                    
                    // Load the data
                    people = data.people || [];
                    assets = data.assets || [];
                    segments = data.segments || [];
                    episodeDetails = data.episodeDetails || { title: '', number: '', season: '' };
                    
                    // Update UI - all tabs
                    renderPeople();
                    renderAssets();
                    renderSegments();
                    renderAddedSegmentsList();
                    renderPlannerPeople();
                    renderPlannerAssets();
                    updateCalculator();
                    loadEpisodeDetails();
                    updateGoLiveStats();
                    displayCurrentSegment();
                    
                    // Save to localStorage
                    saveToCookies();
                    
                    alert('Show data imported successfully!');
                } catch (error) {
                    console.error('Error importing JSON:', error);
                    alert('Error reading JSON file. Please make sure the file is valid.');
                }
            };
            reader.readAsText(file);
            
            // Reset file input
            event.target.value = '';
        }

        // Render added segments list in Add Content section
        function renderAddedSegmentsList() {
            const container = document.getElementById('addedSegmentsList');
            
            if (segments.length === 0) {
                container.innerHTML = '';
                return;
            }

            let html = '<h3 style="color: #667eea; margin-bottom: 15px; font-size: 16px;">Added Segments:</h3>';
            html += segments.map((segment, index) => `
                <div class="person-item" style="margin-bottom: 10px; flex-direction: row; border-color: #667eea;">
                    <div class="person-info" style="text-align: left; flex: 1;">
                        <strong>${segment.title}</strong>
                        <div style="color: #6c757d; font-size: 14px; margin-top: 5px;">${segment.time} minutes</div>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="btn btn-secondary btn-small" onclick="editSegment(${index})">Edit</button>
                        <button class="btn btn-danger btn-small" onclick="removeSegment(${index})">Remove</button>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = html;
        }

        // Render people list in Planner tab
        function renderPlannerPeople() {
            const container = document.getElementById('plannerPeopleList');
            
            if (people.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No hosts, guests, or producers added yet</p></div>';
                return;
            }

            container.innerHTML = people.map((person, index) => `
                <div class="person-item" style="border-color: ${person.color || '#dee2e6'}">
                    <div class="person-color-bar" style="background: ${person.color || '#667eea'}"></div>
                    <div class="person-info">
                        <strong>${person.name}</strong>
                        <div class="person-badges">
                            ${person.roles.map(role => `
                                <span class="badge badge-custom" style="background: ${person.color || '#667eea'}">${role.charAt(0).toUpperCase() + role.slice(1)}</span>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Render planner assets list
        function renderPlannerAssets() {
            const container = document.getElementById('plannerAssetsList');
            
            if (assets.length === 0) {
                container.innerHTML = '<div class="empty-state"><p>No assets added yet</p></div>';
                return;
            }

            container.innerHTML = assets.map((asset, index) => `
                <div class="person-item" style="border-color: ${asset.color || '#dee2e6'}">
                    <div class="person-color-bar" style="background: ${asset.color || '#43e97b'}"></div>
                    <div class="person-info">
                        <strong>${asset.name}</strong>
                    </div>
                </div>
            `).join('');
        }

        // Edit segment function
        function editSegment(index) {
            const segment = segments[index];
            
            // Populate form fields
            document.getElementById('segmentTitle').value = segment.title;
            document.getElementById('segmentDescription').value = segment.description;
            document.getElementById('estimatedTime').value = segment.time;
            updateCharCounter();
            
            // Populate key points
            const container = document.getElementById('keyPointsContainer');
            container.innerHTML = '';
            
            if (segment.keyPoints.length > 0) {
                segment.keyPoints.forEach((point, idx) => {
                    const isLast = idx === segment.keyPoints.length - 1;
                    const div = document.createElement('div');
                    div.className = 'key-point-item';
                    div.innerHTML = `
                        <input type="text" class="key-point-input" placeholder="Enter key point" value="${point}">
                        <button class="btn ${isLast ? 'btn-primary' : 'btn-danger'} btn-small" onclick="${isLast ? 'addKeyPoint()' : 'removeKeyPoint(this)'}">${isLast ? 'Add' : 'Remove'}</button>
                    `;
                    container.appendChild(div);
                });
            } else {
                container.innerHTML = `
                    <div class="key-point-item">
                        <input type="text" class="key-point-input" placeholder="Enter key point">
                        <button class="btn btn-primary btn-small" onclick="addKeyPoint()">Add</button>
                    </div>
                `;
            }
            
            // Remove the old segment
            segments.splice(index, 1);
            saveToCookies();
            renderAddedSegmentsList();
            
            // Scroll to top of page
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            alert('Segment loaded for editing. Make your changes and click "Add Segment" to save.');
        }

        // Drag and Drop functionality
        let draggedIndex = null;

        function handleDragStart(event) {
            draggedIndex = parseInt(event.currentTarget.dataset.index);
            event.currentTarget.classList.add('dragging');
            event.dataTransfer.effectAllowed = 'move';
        }

        function handleDragEnd(event) {
            event.currentTarget.classList.remove('dragging');
            // Remove drag-over class from all items
            document.querySelectorAll('.segment-item').forEach(item => {
                item.classList.remove('drag-over');
            });
        }

        function handleDragOver(event) {
            event.preventDefault();
            event.dataTransfer.dropEffect = 'move';
            const currentItem = event.currentTarget;
            if (!currentItem.classList.contains('dragging')) {
                currentItem.classList.add('drag-over');
            }
        }

        function handleDragLeave(event) {
            event.currentTarget.classList.remove('drag-over');
        }

        function handleDrop(event) {
            event.preventDefault();
            const dropIndex = parseInt(event.currentTarget.dataset.index);
            
            if (draggedIndex !== null && draggedIndex !== dropIndex) {
                // Reorder the segments array
                const draggedItem = segments[draggedIndex];
                segments.splice(draggedIndex, 1);
                segments.splice(dropIndex, 0, draggedItem);
                
                saveToCookies();
                renderSegments();
                updateCalculator();
            }
            
            event.currentTarget.classList.remove('drag-over');
        }

        // Copy prompt functionality
        function copyPrompt(promptId, feedbackId) {
            const promptText = document.getElementById(promptId).textContent.trim();
            
            navigator.clipboard.writeText(promptText).then(() => {
                // Show feedback
                const feedback = document.getElementById(feedbackId);
                feedback.classList.add('show');
                
                // Hide feedback after 2 seconds
                setTimeout(() => {
                    feedback.classList.remove('show');
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy text: ', err);
                alert('Failed to copy prompt. Please try again.');
            });
        }

        // Ask Copilot functionality
        function askCopilot() {
            window.open('https://copilot.microsoft.com/', '_blank');
        }

        // Ask ChatGPT functionality
        function askChatGPT() {
            window.open('https://chatgpt.com/', '_blank');
        }

        // Ask Gemini functionality
        function askGemini() {
            window.open('https://gemini.google.com/', '_blank');
        }

        // Check screen size and show warning if too small
        function checkScreenSize() {
            const mobileWarning = document.getElementById('mobileWarning');
            const container = document.querySelector('.container');
            
            // Check if user dismissed the warning
            const dismissed = localStorage.getItem('mobileWarningDismissed');
            
            // Show warning if width is less than 768px (tablet breakpoint) and not dismissed
            if (window.innerWidth < 768 && !dismissed) {
                mobileWarning.classList.add('active');
                container.style.display = 'none';
            } else {
                mobileWarning.classList.remove('active');
                container.style.display = 'block';
            }
        }

        function dismissMobileWarning() {
            localStorage.setItem('mobileWarningDismissed', 'true');
            checkScreenSize();
        }

        // Check on load
        checkScreenSize();

        // Re-check on window resize
        window.addEventListener('resize', checkScreenSize);
    </script>
</body>
</html>